<!doctype html/>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Editor</title>
	<link rel="stylesheet" href="main.css">
	<script src="http://code.jquery.com/jquery-1.10.2.min.js" type="text/javascript"></script>
	<script src="jquery.jstree.js"></script>
    <script src="jquery.bxslider.min.js"></script>
	<link href="jquery.bxslider.css" rel="stylesheet" />
	<script src="jPages-master/js/jPages.js"></script>
    <script type="text/javascript" src="jPages-master/js/highlight.pack.js"></script>
    <script type="text/javascript" src="jPages-master/js/tabifier.js"></script>
    <script src="jPages-master/js/js.js"></script>
    <script src="jPages-master/js/jPages.js"></script>
	<link rel="stylesheet" href="jPages-master/css/style.css">
    <link rel="stylesheet" href="jPages-master/css/jPages.css">
    <link rel="stylesheet" href="jPages-master/css/animate.css">
    <link rel="stylesheet" href="jPages-master/css/github.css">

</head>
<body>
    <table border="0">
		<tr>
		<td colspan="2" id="header">
			<h2>Artkick Editor</h2>
		</td>
		</tr>

		<tr>
		<td >
			<div id="divNavTree2" style="width: 300px;height: 425px;overflow: scroll;" >
				<p>Loading...</p>
			</div>
		</td>
		<td valign="top" style="height:200px">
			
			<table border="0">
				<tr>
					<td valign="top">
						<div class="holder" </div>
					</td>
					
				</tr>
				<tr>
					<td valign="top">
						<div id="divMain2" >
							<p>Select ViewList from tree on the left to see images</p>
						</div>
					</td>
					
				</tr>
				

				<tr>
					<td valign="bottom" >
						<div id="divMainImageDetail">
							<table>
								<tr>	
									<td> <label>Title:</label> </td> <td colspan="3"> <input type="text" id="imgTitle" size="60"/> </td>						
								</tr>
								<tr>								
									<td> <label>Artist:</label> </td> <td> <input type="text" id="imgArtist"/> </td>
									<td> <label>Work Date:</label> </td> <td> <input type="text" id="imgWorkDate"/> </td>
								</tr>
								<tr>	
									
									<td> <label>Birth:</label> </td> <td> <input type="text" id="imgBirth"/> </td>
									<td> <label>Death:</label> </td> <td> <input type="text" id="imgDeath"/> </td>
								</tr>
								<tr>							
									<td> <label>Source:</label> </td> <td> <input type="text" id="imgSource"/> </td>
									<td> <label>Medium:</label> </td> <td> <input type="text" id="imgMedium"/> </td>
								</tr>
								<tr>	
									
									<td> <label>Location:</label> </td> <td> <input type="text" id="imgLocation"/> </td>
								</tr>
								<tr>
									<td> <label>View Lists:</label> </td> <td> <input type="text" id="imgViewLists"/> </td>
								</tr>
							</table>
						</div>
					</td>
				</tr>
			</table>
		</tr>

		<tr>
		<td colspan="2" id="footer" >
			Copyright © ArtKick</td>
		</tr>
	</table>

	
	<script type="text/javascript">
	
	$(document).ready(function () {
		jQuery(function($) {
			
		});
	});
	
	var myArr = [];
	var myCategories = [];
	
	$.ajax({
			  url: 'http://evening-garden-3648.herokuapp.com/content/allCategories',
			  dataType: 'jsonp',
			  async: false,
			  
			  success: function(data) {
							myArr.push('<div id="container"> <ul> <li id="treetop"><img src="images/ARTKICKlogo_500.png" width="75" height="18"</img> <ul>');
							$.each(data, function(key, value) {
								$(this).each(function(key, value) {
									//var catViewList = getCatViewLists(value["name"]);
								    myArr.push("<li " + "class=category id=" + convertNameToId(value["name"]) + "><a>" + value["name"] + "</a><ul><a>...</a></ul></li>" );
									myCategories.push(value["name"]);
								});
							});
							myArr.push('</ul></li></ul></div>');
							$('#divNavTree2').html(myArr.join(''));
							//$('#container').jstree();
							for (var i = 0; i < myCategories.length; i++) {
							   getCatViewLists(myCategories[i]);
							}
							
						},
				error: function(data) {
							alert('Error: could not retreive json data for categories');
						}
			});
			
	function convertNameToId(name) {
		//must not have spaces in Id
		return name.replace(' ','__');
	}
	
	function convertIdToName(id) {
		return name.replace('__',' ');
	}
	
	function getCatViewLists(cat) {
		var viewLists = [];
		var strViewLists = "";
		var vlURL = encodeURI('http://evening-garden-3648.herokuapp.com/content/getViewlistsByCategory?catName=' + cat);
		$.ajax({
			  url: vlURL,
			  dataType: 'jsonp',
			  async: false,
			  
			  success: function(data) {
				$.each(data, function(key, value) {
					if (key == 'viewlists') {
						$(this).each(function(key, value) {
							viewLists.push('<li class="viewList" id="' + value["id"] + '"><a>' + value["name"] + "</a>" + "</li>");
						//myCategories.push(value["name"], 
						});
				};
				strViewLists = "<ul>" + viewLists.join('') + "</ul>";
				});
				$(document).find('#' + convertNameToId(cat)).children('ul').html(strViewLists);
				$(document).find('#' + convertNameToId(cat)).find('li.viewList').each(function () {
				$(this).click(function () {
					//alert($(this).attr('id') + 'viewList clicked!');
					getViewListImages($(this).attr('id'));
				});
			});
				if (cat == "Top Lists") $('#container').jstree({
						
						"themes" : {
							
							"dots" : false,
							"icons" : true
						},
						"core": {
							"initially_open": ["treetop"]
						
						}
						});
			  }
		});
		
		//return strViewLists;
	}
	
	function getViewListImages(viewListId) {
		var vlImages = [];
		var strImages = "";
		vlURL = encodeURI('http://evening-garden-3648.herokuapp.com/content/getViewlistsByCategory?catName=Animals');

		var vlImagesURL = encodeURI('http://evening-garden-3648.herokuapp.com/client/getViewlist?id=' + viewListId);
		$.ajax({
			   
			  url: vlImagesURL,
			  dataType: 'jsonp',
			  async: true,
			  beforeSend: function(x) {
				  //if(x && x.overrideMimeType) {
				  // x.overrideMimeType("application/javascript;charset=UTF-8");
				  //}
				  var y = x;
				 },
			  success: function(data) {
				$.each(data, function(key, value) {
					if (key == 'imageSet') {
						$(this).each(function(key, value) {
							vlImages.push('<li class="viewListImage" id="' + value["id"] + '" ' +
								getImageAttributes(value) + 
								'><img src="' + value["thumbnail"] + '" width="100" height="100"</img>' + '</li>');
						});
					};
					strImages = '<ul id="thumbs" >' + vlImages.join('') + '</ul>';
				});
				$(document).find('#divMain2').html(strImages);
				//$('#thumbs').bxSlider({ infiniteLoop: false, hideControlOnEnd: true, minSlides: 2, maxSlides: 2, slideWidth: 380, slideMargin: 10});
				//$("#divMain2ImageNav").jPages({containerID : "thumbs"});
				$("div.holder").jPages({
				  containerID : "thumbs",
				  perPage     : 50,
				  previous    : ".prev",
				  next        : ".next",
				  links       : "blank",
				  direction   : "auto",
				  animation   : "fadeInleft"
				});
				
				$(document).find('#divMain2').find('li.viewListImage').each(function () {
				    $(this).click(function () {			    
						fillImageAttrUI($(this));
						$(this).addClass("selected")
						  .siblings()
						  .removeClass("selected");						
				    });
			    });
			  },
			  
		});
		
		//return strViewLists;
	}
	
	function getImageAttributes(value) {
		var strAttrs =  
			'title="' + value["Title"] + '" ' +
			'artist="' + value["Artist First N"] + ' ' + value["Artist Last N"] + '" ' +
			'workDate="' + value["Year"] + '" ' +
			'birthDate="' + value["Birthdate"] + '" ' +
			'deathDate="' + value["Died"] + '" ' +
			'source="' + value["Source"] + '" ' +
			'medium="' + value["Type"] + '" ' +
			'location="' + value["Location"] + '" ' +
			''; //'viewLists="' + value["Title"] + '" ' +
		return strAttrs;
	}
	
	function fillImageAttrUI(image)
	{
		$('#imgTitle').val(image.attr('title'));
		$('#imgArtist').val(image.attr('artist'));
		$('#imgWorkDate').val(image.attr('workDate'));
		$('#imgBirth').val(image.attr('birthDate'));
		$('#imgDeath').val(image.attr('deathDate'));
		$('#imgSource').val(image.attr('source'));
		$('#imgMedium').val(image.attr('medium'));
		$('#imgLocation').val(image.attr('location'));
		//$('#imgViewLists').val(image.attr('title'));				
	}
	
	</script>
	
	<style type="text/css">
  ul#thumbs { list-style: none; margin: 0px; padding:0px; margin-top: 10px; }
  ul#thumbs li { float: left; margin-right: 10px; margin-bottom: 10px; cursor:pointer; }
  ul#thumbs li img { height: 75px; vertical-align: top; }
  ul#thumbs li.selected { outline: 3px solid #FF4242; }

  div#img img { width: 600px; height: 400px; }

  div#btns{ position:relative; width: 600px; }
  .prev, .next { width:29px; height:29px; position: absolute; top: -95px; cursor: pointer; }
  .prev { background-image: url('img/back.gif'); left: -40px; }
  .next { background-image: url('img/next.gif'); right: -40px; }

  .jp-disabled{ display:none; }
  </style>
</body>
</html>