//>>built
define("demos/survey/src/form",["dojo","dijit","dojox","dojo/require!dojox/cometd"],function(_1,_2,_3){_1.provide("demos.survey.src.form");_1.require("dojox.cometd");(function(){var _4=function(e){e.preventDefault();_1.xhrPost({url:"src/submit.php",form:"survey",load:function(_5,_6){_1.byId("postSurvey").disabled=true;_1.fadeOut({node:"container",onEnd:function(){var _7=_5;_1.byId("responseText").innerHTML=_5;_1.style("formNode","display","none");_1.fadeIn({node:"container",onEnd:function(){getResults();_3.cometd.publish("/demo/survey/redraw",{content:_7});_3.cometd.subscribe("/demo/survey/redraw",function(){getResults();});}}).play(5);}}).play();}});};var _8=function(e){var _9,lc,_a;if(!(e.type&&e.type=="click")){_9=e;}else{var n=_1.byId("other");_9=n.value;n.value="";n.focus();_a=true;_1.stopEvent(e);}lc=_9.toLowerCase();if(!_9||_1.byId(lc)){return;}var cb=_1.doc.createElement("input");cb["type"]="checkbox";cb["name"]=lc;cb.id=lc;if(_a){cb.checked="checked";}var _b=_1.doc.createElement("label");_b.setAttribute("for",lc);_b.innerHTML=" "+_9.replace(/</g,"&lt;");var br=_1.doc.createElement("br");var _c=_1.byId("choices");_c.appendChild(cb);_c.appendChild(_b);_c.appendChild(br);if(_a){_3.cometd.publish("/demo/survey/newoption",{option:_9});}};_1.addOnLoad(function(){_1.xhrGet({url:"src/results.php",handleAs:"json",load:function(_d,_e){for(var t in _d.data){_8(t);}}});_3.cometd.init("http://cometd.sitepen.com/cometd");_3.cometd.subscribe("/demo/survey/newoption",function(o){var _f=o.data.option;var lc=_f.toLowerCase();if(!_1.byId(lc)){_8(_f);}});_1.connect(_1.byId("survey"),"onsubmit",_4);_1.connect(_1.byId("addChoice"),"onclick",_8);});})();});