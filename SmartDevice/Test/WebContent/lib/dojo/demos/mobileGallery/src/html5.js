//>>built
define("demos/mobileGallery/src/html5",["dojo/_base/lang","dojo/_base/connect","dojo/_base/declare","dojo/_base/window","dojo/dom","dojo/dom-geometry","dojo/_base/Deferred","dojo/DeferredList","dojo/io/script","dijit/registry","dojo/query","./structure","dojox/mobile/TextArea"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){var _d=[];var _e=_4.global.localStorage||null;var _f=false;var _10="Unknown",_11=0,_12=0;var _13,_14;function _15(_16){if(_e){return _e.getItem(_16);}else{return "";}};function _17(_18,val){if(_e){_e.setItem(_18,val);}};var Map=_3(null,{constructor:function(_19){this.id=_19.id;this.center=_19.center;this.options={center:_19.center,zoom:(_c.layout.leftPane.hidden?11:12),mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:false,zoomControl:true,mapTypeControl:true,scaleControl:true,streetViewControl:true,overviewMapControl:false,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL}};},load:function(){this.map=new google.maps.Map(document.getElementById(this.id),this.options);this.marker=new google.maps.Marker({map:this.map,position:this.center});},setCenter:function(_1a){if(_1a&&(!this.center||(!this.center.equals(_1a)))){this.center=_1a;if(this.map){this.map.setCenter(this.center);this.marker.setPosition(this.center);}}},resize:function(){google.maps.event.trigger(this.map,"resize");this.map.setCenter(this.center);}});var _1b;var _1c=new _7();var _1d=_1.getObject("demos.mobileGallery.html5",true);_1d.mapApiLoaded=function(){_1e();_1c.resolve();};function _1f(){if(!_4.global.google||!_4.global.google.maps){_9.get({url:"http://maps.google.com/maps/api/js",content:{sensor:false,callback:"demos.mobileGallery.html5.mapApiLoaded"},timeout:30000,error:function(err){_5.byId("noteLocMapDiv").innerHTML=err;_1c.reject();}});}else{if(_1c===-1){_1c.resolve();}}};function _1e(){if(!_1b){var _20={id:"noteLocMapDiv",center:((_13&&_14)?new google.maps.LatLng(_13,_14):new google.maps.LatLng(-34.397,150.644))};_1b=new Map(_20);_1b.load();_1b.resize();}};function _21(){var box=_6.getMarginBox("html5");box.h=_4.global.innerHeight-_6.getMarginBox("header").h;_6.setMarginBox("noteLocMapView",box);};function _22(_23){_11=_23.latitude;_12=_23.longitude;var _24=new google.maps.Geocoder();var _25=new google.maps.LatLng(_23.latitude,_23.longitude);_24.geocode({"latLng":_25},function(_26,_27){if(_27===google.maps.GeocoderStatus.OK){var _28="",_29="",_2a="";var _2b=_26[0].address_components;for(var i=0;i<_2b.length;++i){var _2c=_2b[i];switch(_2c.types[0]){case "country":_28=_2c.short_name;break;case "administrative_area_level_1":_29=_2c.short_name;break;case "locality":_2a=_2c.long_name;break;default:}}var _2d=_2a+", "+_29+", "+_28;_10=_2d;if(_5.byId("noteLocAddr").innerHTML=="Unknown"){_5.byId("noteLocAddr").innerHTML=_10;_1b.setCenter(new google.maps.LatLng(_11,_12));_13=_11;_14=_12;}}else{_2e();}});};function _2e(){_5.byId("noteLocAddr").innerHTML="Unknown";};return {init:function(){var _2f=_15("noteLocAddr");if(!_2f){_2f="Unknown";}_13=parseFloat(_15("noteLocLat"));_14=parseFloat(_15("noteLocLng"));var _30=_15("noteDate");if(!_30){_30=(new Date()).toDateString();}var _31=_15("noteText");if(_31){_5.byId("noteDate").innerHTML=_30;_5.byId("noteLocAddr").innerHTML=_2f;_5.byId("noteText").value=_31;}else{_5.byId("noteDate").innerHTML=(new Date()).toDateString();_5.byId("noteLocAddr").innerHTML="Unknown";_5.byId("noteText").value="";}_a.byId("html5").on("afterTransitionIn",function(){if(this.movedFrom==="source"){return;}_21();_1f();if(!!_4.global.navigator.geolocation||_1c.fired!==1){var _32=new _7();if(_1c.fired===-1){new _8([_1c,_32]).then(function(_33){if(!_33[0][0]){return;}if(_33[1][0]){_22(_33[1][1]);}else{_2e();}});}else{_32.then(_22,_2e);}_4.global.navigator.geolocation.getCurrentPosition(function(_34){_32.resolve(_34.coords);},function(){_32.reject();});}else{_2e();}});_a.byId("noteText").on("change",function(){_f=true;});setInterval(function(){if(_f){_17("noteDate",_5.byId("noteDate").innerHTML);_17("noteLocAddr",_10);_17("noteLocLat",_11);_17("noteLocLng",_12);_17("noteText",_5.byId("noteText").value);_5.byId("noteLocAddr").innerHTML=_10;_13=_11;_14=_12;if(_1b){_1b.setCenter(new google.maps.LatLng(_13,_14));}_f=false;}},30000);_a.byId("newNoteBtn").on("click",function(){_e.removeItem("noteDate");_e.removeItem("noteLocAddr");_e.removeItem("noteText");_5.byId("noteDate").innerHTML=(new Date()).toDateString();_5.byId("noteLocAddr").innerHTML=_10;_13=_11;_14=_12;if(_1b&&_11&&_12){_1b.setCenter(new google.maps.LatLng(_11,_12));}_5.byId("noteText").value="";});_a.byId("showMapBtn").on("click",function(){_a.byId("html5Main").performTransition("noteLocMapView",1,"slide");});_a.byId("html5").on("resize",function(){_21();if(_1b){_1b.resize();}});_a.byId("noteLocMapView").on("afterTransitionIn",function(){if(_1b){_1b.resize();}_c.navRecords.push({from:"html5Main",fromTitle:"HTML5",to:"noteLocMapView",toTitle:"HTML5",navTitle:"HTML5"});});_a.byId("html5").on("beforeTransitionOUt",function(){var _35=_c.navRecords;_d=[];for(var i=0;i<_35.length;++i){var _36=_35[i];if(_36.from=="navigation"||_36.to=="source"){continue;}_d.push(_36);}});_2.subscribe("onAfterDemoViewTransitionIn",function(id){if(id==="html5"){var _37=_c.navRecords;for(var i=0;i<_d.length;++i){_37.push(_d[i]);}}});}};});