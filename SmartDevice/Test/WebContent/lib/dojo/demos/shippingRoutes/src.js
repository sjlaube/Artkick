/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

//>>built
require({cache:{"demos/shippingRoutes/src/Ecr":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/html","dojo/_base/array","dojo/_base/lang","dojo/dom","dojox/geo/openlayers/Map","dojox/geo/openlayers/GfxLayer","dojo/data/ItemFileReadStore","./PortRenderer","./LegsRenderer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){return _2(null,{constructor:function(){var _c=new _7("map");_c.fitTo([-160,70,160,-70]);this._map=_c;layer=new _8("legs");this._legLayer=layer;_c.addLayer(layer);layer=new _8("ports");this._portLayer=layer;_c.addLayer(layer);this.loadData("data/ecr.json");},fitTo:function(_d){this._map.fitTo(_d);},clearLayer:function(_e){var fa=_e.getFeatures();_e.removeFeature(fa);},clearEcr:function(_f){var _10=this._portLayer;this.clearLayer(_10);_10=this._legLayer;this.clearLayer(_10);this.fillPortChooser(null);},setDataSet:function(_11){var o=_6.byId(_11);var ds=o.value;var _12=this._portLayer;this.clearLayer(_12);_12=this._legLayer;this.clearLayer(_12);this.loadData(ds);},log:function(o){},loadError:function(){this.log(arguments[0]);},_portStyle:[{type:"circle",depth:"{radius}",radius:function(ctx){var _13=ctx.store.getValue(this,"offer");var ret=Math.max(1,Math.log(_13));return 3*ret;},stroke:{color:"#4c9a06",width:1}},{type:"circle",depth:"{radius}",radius:function(ctx){var _14=ctx.store.getValue(this,"demand");return 3*Math.max(1,Math.log(_14));},stroke:{color:"#bb0000",width:1}}],gotPorts:function(_15,_16){this.log("got ports "+_15.length);var _17=_16.store;var ctx={store:_17};var _18=new _a(this._portStyle,ctx);var _19=this._portLayer;_4.forEach(_15,function(_1a,_1b,_1c){var f=_18.render(_1a);if(f!=null){_19.addFeature(f);}});this.fillPortChooser(_15);this.portChange("portChooser");_19.redraw();},_legsStyle:{type:"polyline",stroke:{color:[255,165,0]}},gotLegs:function(_1d,_1e){var ctx={store:_1e.store};var _1f=new _b(this._legsStyle,ctx);_1f.setGeodetic(true);var _20=this._legLayer;_4.forEach(_1d,function(_21,_22,_23){var f=_1f.render(_21);if(f!=null){_20.addFeature(f);}});_20.redraw();},loadData:function(_24){var _25=new _9({url:_24,urlPreventCache:true});_25.fetch({query:{type:"legs"},onComplete:_5.hitch(this,this.gotLegs),onError:_5.hitch(this,this.loadError),queryOptions:{deep:true}});_25.fetch({query:{type:"port"},onComplete:_5.hitch(this,this.gotPorts),onError:_5.hitch(this,this.loadError)});},regionChange:function(_26){this.fitTo(_26.currentTarget.value);},portChange:function(_27){var o=_6.byId(_27);this.fitTo(o.value);},fillPortChooser:function(_28){var ps=_6.byId("portChooser");var _29=ps.options;var ws="{\"position\": [0, 0], \"extent\": 70}";if(_28==null){_29.length=1;_29[0]=new Option("World",ws);}else{_29.length=_28.length+1;_29[0]=new Option("World",ws);var s="{\"position\": [%lo, %la], \"extent\": 0.2}";for(var i=0;i<_28.length;i++){var _2a=_28[i];var lon=parseFloat(_2a.longitude);var lat=parseFloat(_2a.latitude);var os=s.replace("%lo",lon).replace("%la",lat);_29[i+1]=new Option(_2a.name,os);}}},toggleLayerVisibility:function(_2b){var cb=_6.byId(_2b);var a=this._map.getLayer("name",_2b);_4.forEach(a,function(_2c,_2d,_2e){_2c.olLayer.setVisibility(cb.checked);});}});});},"dojox/geo/openlayers/Map":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/dom","dojo/dom-style","./_base","./TouchInteractionSupport","./Layer","./Patch"],function(_2f,_30,_31,_32,_33,dom,_34,_35,_36,_37,_38){_2f.experimental("dojox.geo.openlayers.Map");_38.patchGFX();return _30("dojox.geo.openlayers.Map",null,{olMap:null,_tp:null,constructor:function(div,_39){if(!_39){_39={};}div=dom.byId(div);this._tp={x:0,y:0};var _3a=_39.openLayersMapOptions;if(!_3a){_3a={controls:[new OpenLayers.Control.ScaleLine({maxWidth:200}),new OpenLayers.Control.Navigation()]};}if(_39.accessible){var kbd=new OpenLayers.Control.KeyboardDefaults();if(!_3a.controls){_3a.controls=[];}_3a.controls.push(kbd);}var _3b=_39.baseLayerType;if(!_3b){_3b=_35.BaseLayerType.OSM;}var map=new OpenLayers.Map(div,_3a);this.olMap=map;this._layerDictionary={olLayers:[],layers:[]};if(_39.touchHandler){this._touchControl=new _36(map);}var _3c=this._createBaseLayer(_39);this.addLayer(_3c);this.initialFit(_39);},initialFit:function(_3d){var o=_3d.initialLocation;if(!o){o=[-160,70,160,-70];}this.fitTo(o);},setBaseLayerType:function(_3e){if(_3e==this.baseLayerType){return null;}var o=null;if(typeof _3e=="string"){o={baseLayerName:_3e,baseLayerType:_3e};this.baseLayerType=_3e;}else{if(typeof _3e=="object"){o=_3e;this.baseLayerType=o.baseLayerType;}}var bl=null;if(o!=null){bl=this._createBaseLayer(o);if(bl!=null){var olm=this.olMap;var ob=olm.getZoom();var oc=olm.getCenter();var _3f=!!oc&&!!olm.baseLayer&&!!olm.baseLayer.map;if(_3f){var _40=olm.getProjectionObject();if(_40!=null){oc=oc.transform(_40,_35.EPSG4326);}}var old=olm.baseLayer;if(old!=null){var l=this._getLayer(old);this.removeLayer(l);}if(bl!=null){this.addLayer(bl);}if(_3f){_40=olm.getProjectionObject();if(_40!=null){oc=oc.transform(_35.EPSG4326,_40);}olm.setCenter(oc,ob);}}}return bl;},getBaseLayerType:function(){return this.baseLayerType;},getScale:function(_41){var _42=null;var om=this.olMap;if(_41){var _43=om.getUnits();if(!_43){return null;}var _44=OpenLayers.INCHES_PER_UNIT;_42=(om.getGeodesicPixelSize().w||0.000001)*_44["km"]*OpenLayers.DOTS_PER_INCH;}else{_42=om.getScale();}return _42;},getOLMap:function(){return this.olMap;},_createBaseLayer:function(_45){var _46=null;var _47=_45.baseLayerType;var url=_45.baseLayerUrl;var _48=_45.baseLayerName;var _49=_45.baseLayerOptions;if(!_48){_48=_47;}if(!_49){_49={};}switch(_47){case _35.BaseLayerType.OSM:_49.transitionEffect="resize";_46=new _37(_48,{olLayer:new OpenLayers.Layer.OSM(_48,url,_49)});break;case _35.BaseLayerType.WMS:if(!url){url="http://labs.metacarta.com/wms/vmap0";if(!_49.layers){_49.layers="basic";}}_46=new _37(_48,{olLayer:new OpenLayers.Layer.WMS(_48,url,_49,{transitionEffect:"resize"})});break;case _35.BaseLayerType.GOOGLE:_46=new _37(_48,{olLayer:new OpenLayers.Layer.Google(_48,_49)});break;case _35.BaseLayerType.VIRTUAL_EARTH:_46=new _37(_48,{olLayer:new OpenLayers.Layer.VirtualEarth(_48,_49)});break;case _35.BaseLayerType.YAHOO:_46=new _37(_48,{olLayer:new OpenLayers.Layer.Yahoo(_48,_49)});break;case _35.BaseLayerType.ARCGIS:if(!url){url="http://server.arcgisonline.com/ArcGIS/rest/services/ESRI_StreetMap_World_2D/MapServer/export";}_46=new _37(_48,{olLayer:new OpenLayers.Layer.ArcGIS93Rest(_48,url,_49,{})});break;}if(_46==null){if(_47 instanceof OpenLayers.Layer){_46=_47;}else{_49.transitionEffect="resize";_46=new _37(_48,{olLayer:new OpenLayers.Layer.OSM(_48,url,_49)});this.baseLayerType=_35.BaseLayerType.OSM;}}return _46;},removeLayer:function(_4a){var om=this.olMap;var i=_32.indexOf(this._layerDictionary.layers,_4a);if(i>0){this._layerDictionary.layers.splice(i,1);}var oll=_4a.olLayer;var j=_32.indexOf(this._layerDictionary.olLayers,oll);if(j>0){this._layerDictionary.olLayers.splice(i,j);}om.removeLayer(oll,false);},layerIndex:function(_4b,_4c){var olm=this.olMap;if(!_4c){return olm.getLayerIndex(_4b.olLayer);}olm.setLayerIndex(_4b.olLayer,_4c);this._layerDictionary.layers.sort(function(l1,l2){return olm.getLayerIndex(l1.olLayer)-olm.getLayerIndex(l2.olLayer);});this._layerDictionary.olLayers.sort(function(l1,l2){return olm.getLayerIndex(l1)-olm.getLayerIndex(l2);});return _4c;},addLayer:function(_4d){_4d.dojoMap=this;var om=this.olMap;var ol=_4d.olLayer;this._layerDictionary.olLayers.push(ol);this._layerDictionary.layers.push(_4d);om.addLayer(ol);_4d.added();},_getLayer:function(ol){var i=_32.indexOf(this._layerDictionary.olLayers,ol);if(i!=-1){return this._layerDictionary.layers[i];}return null;},getLayer:function(_4e,_4f){var om=this.olMap;var ols=om.getBy("layers",_4e,_4f);var ret=new Array();_32.forEach(ols,function(ol){ret.push(this._getLayer(ol));},this);return ret;},getLayerCount:function(){var om=this.olMap;if(om.layers==null){return 0;}return om.layers.length;},fitTo:function(o){var map=this.olMap;var _50=_35.EPSG4326;if(o==null){var c=this.transformXY(0,0,_50);map.setCenter(new OpenLayers.LonLat(c.x,c.y));return;}var b=null;if(typeof o=="string"){var j=_33.fromJson(o);}else{j=o;}var ul;var lr;if(j.hasOwnProperty("bounds")){var a=j.bounds;b=new OpenLayers.Bounds();ul=this.transformXY(a[0],a[1],_50);b.left=ul.x;b.top=ul.y;lr=this.transformXY(a[2],a[3],_50);b.right=lr.x;b.bottom=lr.y;}if(b==null){if(j.hasOwnProperty("position")){var p=j.position;var e=j.hasOwnProperty("extent")?j.extent:1;if(typeof e=="string"){e=parseFloat(e);}b=new OpenLayers.Bounds();ul=this.transformXY(p[0]-e,p[1]+e,_50);b.left=ul.x;b.top=ul.y;lr=this.transformXY(p[0]+e,p[1]-e,_50);b.right=lr.x;b.bottom=lr.y;}}if(b==null){if(o.length==4){b=new OpenLayers.Bounds();if(false){b.left=o[0];b.top=o[1];b.right=o[2];b.bottom=o[3];}else{ul=this.transformXY(o[0],o[1],_50);b.left=ul.x;b.top=ul.y;lr=this.transformXY(o[2],o[3],_50);b.right=lr.x;b.bottom=lr.y;}}}if(b!=null){map.zoomToExtent(b,true);}},transform:function(p,_51,to){return this.transformXY(p.x,p.y,_51,to);},transformXY:function(x,y,_52,to){var tp=this._tp;tp.x=x;tp.y=y;if(!_52){_52=_35.EPSG4326;}if(!to){to=this.olMap.getProjectionObject();}tp=OpenLayers.Projection.transform(tp,_52,to);return tp;}});});},"dojox/geo/openlayers/_base":function(){define(["dojo/_base/lang"],function(_53){var _54=_53.getObject("dojox.geo.openlayers",true);_54.BaseLayerType={OSM:"OSM",WMS:"WMS",GOOGLE:"Google",VIRTUAL_EARTH:"VirtualEarth",BING:"VirtualEarth",YAHOO:"Yahoo",ARCGIS:"ArcGIS"};_54.EPSG4326=new OpenLayers.Projection("EPSG:4326");var re=/^\s*(\d{1,3})[DÂ°]\s*(\d{1,2})[M']\s*(\d{1,2}\.?\d*)\s*(S|"|'')\s*([NSEWnsew]{0,1})\s*$/i;_54.parseDMS=function(v,_55){var res=re.exec(v);if(res==null||res.length<5){return parseFloat(v);}var d=parseFloat(res[1]);var m=parseFloat(res[2]);var s=parseFloat(res[3]);var _56=res[5];if(_55){var lc=_56.toLowerCase();var dd=d+(m+s/60)/60;if(lc=="w"||lc=="s"){dd=-dd;}return dd;}return [d,m,s,_56];};return _54;});},"dojox/geo/openlayers/TouchInteractionSupport":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/html","dojo/_base/lang","dojo/_base/event","dojo/_base/window"],function(_57,_58,_59,_5a,_5b,win){return _57("dojox.geo.openlayers.TouchInteractionSupport",null,{_map:null,_centerTouchLocation:null,_touchMoveListener:null,_touchEndListener:null,_initialFingerSpacing:null,_initialScale:null,_tapCount:null,_tapThreshold:null,_lastTap:null,constructor:function(map){this._map=map;this._centerTouchLocation=new OpenLayers.LonLat(0,0);var div=this._map.div;_58.connect(div,"touchstart",this,this._touchStartHandler);_58.connect(div,"touchmove",this,this._touchMoveHandler);_58.connect(div,"touchend",this,this._touchEndHandler);this._tapCount=0;this._lastTap={x:0,y:0};this._tapThreshold=100;},_getTouchBarycenter:function(_5c){var _5d=_5c.touches;var _5e=_5d[0];var _5f=null;if(_5d.length>1){_5f=_5d[1];}else{_5f=_5d[0];}var _60=_59.marginBox(this._map.div);var _61=(_5e.pageX+_5f.pageX)/2-_60.l;var _62=(_5e.pageY+_5f.pageY)/2-_60.t;return {x:_61,y:_62};},_getFingerSpacing:function(_63){var _64=_63.touches;var _65=-1;if(_64.length>=2){var dx=(_64[1].pageX-_64[0].pageX);var dy=(_64[1].pageY-_64[0].pageY);_65=Math.sqrt(dx*dx+dy*dy);}return _65;},_isDoubleTap:function(_66){var _67=false;var _68=_66.touches;if((this._tapCount>0)&&_68.length==1){var dx=(_68[0].pageX-this._lastTap.x);var dy=(_68[0].pageY-this._lastTap.y);var _69=dx*dx+dy*dy;if(_69<this._tapThreshold){_67=true;}else{this._tapCount=0;}}this._tapCount++;this._lastTap.x=_68[0].pageX;this._lastTap.y=_68[0].pageY;setTimeout(_5a.hitch(this,function(){this._tapCount=0;}),300);return _67;},_doubleTapHandler:function(_6a){var _6b=_6a.touches;var _6c=_59.marginBox(this._map.div);var _6d=_6b[0].pageX-_6c.l;var _6e=_6b[0].pageY-_6c.t;var _6f=this._map.getLonLatFromPixel(new OpenLayers.Pixel(_6d,_6e));this._map.setCenter(new OpenLayers.LonLat(_6f.lon,_6f.lat),this._map.getZoom()+1);},_touchStartHandler:function(_70){_5b.stop(_70);if(this._isDoubleTap(_70)){this._doubleTapHandler(_70);return;}var _71=this._getTouchBarycenter(_70);this._centerTouchLocation=this._map.getLonLatFromPixel(new OpenLayers.Pixel(_71.x,_71.y));this._initialFingerSpacing=this._getFingerSpacing(_70);this._initialScale=this._map.getScale();if(!this._touchMoveListener){this._touchMoveListener=_58.connect(win.global,"touchmove",this,this._touchMoveHandler);}if(!this._touchEndListener){this._touchEndListener=_58.connect(win.global,"touchend",this,this._touchEndHandler);}},_touchEndHandler:function(_72){_5b.stop(_72);var _73=_72.touches;if(_73.length==0){if(this._touchMoveListener){_58.disconnect(this._touchMoveListener);this._touchMoveListener=null;}if(this._touchEndListener){_58.disconnect(this._touchEndListener);this._touchEndListener=null;}}else{var _74=this._getTouchBarycenter(_72);this._centerTouchLocation=this._map.getLonLatFromPixel(new OpenLayers.Pixel(_74.x,_74.y));}},_touchMoveHandler:function(_75){_5b.stop(_75);var _76=this._getTouchBarycenter(_75);var _77=this._map.getLonLatFromPixel(new OpenLayers.Pixel(_76.x,_76.y));var _78=_77.lon-this._centerTouchLocation.lon;var _79=_77.lat-this._centerTouchLocation.lat;var _7a=1;var _7b=_75.touches;if(_7b.length>=2){var _7c=this._getFingerSpacing(_75);_7a=_7c/this._initialFingerSpacing;this._map.zoomToScale(this._initialScale/_7a);}var _7d=this._map.getCenter();this._map.setCenter(new OpenLayers.LonLat(_7d.lon-_78,_7d.lat-_79));}});});},"dojox/geo/openlayers/Layer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/sniff","./Feature"],function(_7e,_7f,_80,_81,_82){return _7e("dojox.geo.openlayers.Layer",null,{constructor:function(_83,_84){var ol=_84?_84.olLayer:null;if(!ol){ol=_7f.delegate(new OpenLayers.Layer(_83,_84));}this.olLayer=ol;this._features=null;this.olLayer.events.register("moveend",this,_7f.hitch(this,this.moveTo));},renderFeature:function(f){f.render();},getDojoMap:function(){return this.dojoMap;},addFeature:function(f){if(_7f.isArray(f)){_80.forEach(f,function(_85){this.addFeature(_85);},this);return;}if(this._features==null){this._features=[];}this._features.push(f);f._setLayer(this);},removeFeature:function(f){var ft=this._features;if(ft==null){return;}if(f instanceof Array){f=f.slice(0);_80.forEach(f,function(_86){this.removeFeature(_86);},this);return;}var i=_80.indexOf(ft,f);if(i!=-1){ft.splice(i,1);}f._setLayer(null);f.remove();},removeFeatureAt:function(_87){var ft=this._features;var f=ft[_87];if(!f){return;}ft.splice(_87,1);f._setLayer(null);f.remove();},getFeatures:function(){return this._features;},getFeatureAt:function(i){if(this._features==null){return undefined;}return this._features[i];},getFeatureCount:function(){if(this._features==null){return 0;}return this._features.length;},clear:function(){var fa=this.getFeatures();this.removeFeature(fa);},moveTo:function(_88){if(_88.zoomChanged){if(this._features==null){return;}_80.forEach(this._features,function(f){this.renderFeature(f);},this);}},redraw:function(){if(_81.isIE){setTimeout(_7f.hitch(this,function(){this.olLayer.redraw();},0));}else{this.olLayer.redraw();}},added:function(){}});});},"dojox/geo/openlayers/Feature":function(){define(["dojo/_base/kernel","dojo/_base/declare","./_base"],function(_89,_8a,_8b){return _8a("dojox.geo.openlayers.Feature",null,{constructor:function(){this._layer=null;this._coordSys=_8b.EPSG4326;},getCoordinateSystem:function(){return this._coordSys;},setCoordinateSystem:function(cs){this._coordSys=cs;},getLayer:function(){return this._layer;},_setLayer:function(l){this._layer=l;},render:function(){},remove:function(){},_getLocalXY:function(p){var x=p.x;var y=p.y;var _8c=this.getLayer();var _8d=_8c.olLayer.map.getResolution();var _8e=_8c.olLayer.getExtent();var rx=(x/_8d+(-_8e.left/_8d));var ry=((_8e.top/_8d)-y/_8d);return [rx,ry];}});});},"dojox/geo/openlayers/Patch":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/sniff","dojox/gfx","dojox/gfx/shape"],function(_8f,_90,_91,gfx,_92){var dgo=_90.getObject("geo.openlayers",true,dojox);dgo.Patch={patchMethod:function(_93,_94,_95,_96){var old=_93.prototype[_94];_93.prototype[_94]=function(){var _97=_94;if(_95){_95.call(this,_97,arguments);}var ret=old.apply(this,arguments);if(_96){ret=_96.call(this,_97,ret,arguments)||ret;}return ret;};},patchGFX:function(){var _98=function(){if(!this.rawNode.path){this.rawNode.path={};}};var _99=function(){if(this.rawNode.fill&&!this.rawNode.fill.colors){this.rawNode.fill.colors={};}};if(_91.isIE<=8&&gfx.renderer==="vml"){this.patchMethod(gfx.Line,"setShape",_98,null);this.patchMethod(gfx.Polyline,"setShape",_98,null);this.patchMethod(gfx.Path,"setShape",_98,null);this.patchMethod(_92.Shape,"setFill",_99,null);}}};return dgo.Patch;});},"dojox/gfx":function(){define(["dojo/_base/lang","./gfx/_base","./gfx/renderer!"],function(_9a,_9b,_9c){_9b.switchTo(_9c);return _9b;});},"dojox/gfx/_base":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/Color","dojo/_base/sniff","dojo/_base/window","dojo/_base/array","dojo/dom","dojo/dom-construct","dojo/dom-geometry"],function(_9d,_9e,_9f,has,win,arr,dom,_a0,_a1){var g=_9e.getObject("dojox.gfx",true),b=g._base={};g._hasClass=function(_a2,_a3){var cls=_a2.getAttribute("className");return cls&&(" "+cls+" ").indexOf(" "+_a3+" ")>=0;};g._addClass=function(_a4,_a5){var cls=_a4.getAttribute("className")||"";if(!cls||(" "+cls+" ").indexOf(" "+_a5+" ")<0){_a4.setAttribute("className",cls+(cls?" ":"")+_a5);}};g._removeClass=function(_a6,_a7){var cls=_a6.getAttribute("className");if(cls){_a6.setAttribute("className",cls.replace(new RegExp("(^|\\s+)"+_a7+"(\\s+|$)"),"$1$2"));}};b._getFontMeasurements=function(){var _a8={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,"small":0,"medium":0,"large":0,"x-large":0,"xx-large":0};var p;if(has("ie")){win.doc.documentElement.style.fontSize="100%";}var div=_a0.create("div",{style:{position:"absolute",left:"0",top:"-100px",width:"30px",height:"1000em",borderWidth:"0",margin:"0",padding:"0",outline:"none",lineHeight:"1",overflow:"hidden"}},win.body());for(p in _a8){div.style.fontSize=p;_a8[p]=Math.round(div.offsetHeight*12/16)*16/12/1000;}win.body().removeChild(div);return _a8;};var _a9=null;b._getCachedFontMeasurements=function(_aa){if(_aa||!_a9){_a9=b._getFontMeasurements();}return _a9;};var _ab=null,_ac={};b._getTextBox=function(_ad,_ae,_af){var m,s,al=arguments.length;var i;if(!_ab){_ab=_a0.create("div",{style:{position:"absolute",top:"-10000px",left:"0"}},win.body());}m=_ab;m.className="";s=m.style;s.borderWidth="0";s.margin="0";s.padding="0";s.outline="0";if(al>1&&_ae){for(i in _ae){if(i in _ac){continue;}s[i]=_ae[i];}}if(al>2&&_af){m.className=_af;}m.innerHTML=_ad;if(m["getBoundingClientRect"]){var bcr=m.getBoundingClientRect();return {l:bcr.left,t:bcr.top,w:bcr.width||(bcr.right-bcr.left),h:bcr.height||(bcr.bottom-bcr.top)};}else{return _a1.getMarginBox(m);}};b._computeTextLocation=function(_b0,_b1,_b2,_b3){var loc={},_b4=_b0.align;switch(_b4){case "end":loc.x=_b0.x-_b1;break;case "middle":loc.x=_b0.x-_b1/2;break;default:loc.x=_b0.x;break;}var c=_b3?0.75:1;loc.y=_b0.y-_b2*c;return loc;};b._computeTextBoundingBox=function(s){if(!g._base._isRendered(s)){return {x:0,y:0,width:0,height:0};}var loc,_b5=s.getShape(),_b6=s.getFont()||g.defaultFont,w=s.getTextWidth(),h=g.normalizedLength(_b6.size);loc=b._computeTextLocation(_b5,w,h,true);return {x:loc.x,y:loc.y,width:w,height:h};};b._isRendered=function(s){var p=s.parent;while(p&&p.getParent){p=p.parent;}return p!==null;};var _b7=0;b._getUniqueId=function(){var id;do{id=_9d._scopeName+"xUnique"+(++_b7);}while(dom.byId(id));return id;};b._fixMsTouchAction=function(_b8){var r=_b8.rawNode;if(typeof r.style.msTouchAction!="undefined"){r.style.msTouchAction="none";}};_9e.mixin(g,{defaultPath:{type:"path",path:""},defaultPolyline:{type:"polyline",points:[]},defaultRect:{type:"rect",x:0,y:0,width:100,height:100,r:0},defaultEllipse:{type:"ellipse",cx:0,cy:0,rx:200,ry:100},defaultCircle:{type:"circle",cx:0,cy:0,r:100},defaultLine:{type:"line",x1:0,y1:0,x2:100,y2:100},defaultImage:{type:"image",x:0,y:0,width:0,height:0,src:""},defaultText:{type:"text",x:0,y:0,text:"",align:"start",decoration:"none",rotated:false,kerning:true},defaultTextPath:{type:"textpath",text:"",align:"start",decoration:"none",rotated:false,kerning:true},defaultStroke:{type:"stroke",color:"black",style:"solid",width:1,cap:"butt",join:4},defaultLinearGradient:{type:"linear",x1:0,y1:0,x2:100,y2:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultRadialGradient:{type:"radial",cx:0,cy:0,r:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultPattern:{type:"pattern",x:0,y:0,width:0,height:0,src:""},defaultFont:{type:"font",style:"normal",variant:"normal",weight:"normal",size:"10pt",family:"serif"},getDefault:(function(){var _b9={};return function(_ba){var t=_b9[_ba];if(t){return new t();}t=_b9[_ba]=new Function();t.prototype=g["default"+_ba];return new t();};})(),normalizeColor:function(_bb){return (_bb instanceof _9f)?_bb:new _9f(_bb);},normalizeParameters:function(_bc,_bd){var x;if(_bd){var _be={};for(x in _bc){if(x in _bd&&!(x in _be)){_bc[x]=_bd[x];}}}return _bc;},makeParameters:function(_bf,_c0){var i=null;if(!_c0){return _9e.delegate(_bf);}var _c1={};for(i in _bf){if(!(i in _c1)){_c1[i]=_9e.clone((i in _c0)?_c0[i]:_bf[i]);}}return _c1;},formatNumber:function(x,_c2){var val=x.toString();if(val.indexOf("e")>=0){val=x.toFixed(4);}else{var _c3=val.indexOf(".");if(_c3>=0&&val.length-_c3>5){val=x.toFixed(4);}}if(x<0){return val;}return _c2?" "+val:val;},makeFontString:function(_c4){return _c4.style+" "+_c4.variant+" "+_c4.weight+" "+_c4.size+" "+_c4.family;},splitFontString:function(str){var _c5=g.getDefault("Font");var t=str.split(/\s+/);do{if(t.length<5){break;}_c5.style=t[0];_c5.variant=t[1];_c5.weight=t[2];var i=t[3].indexOf("/");_c5.size=i<0?t[3]:t[3].substring(0,i);var j=4;if(i<0){if(t[4]=="/"){j=6;}else{if(t[4].charAt(0)=="/"){j=5;}}}if(j<t.length){_c5.family=t.slice(j).join(" ");}}while(false);return _c5;},cm_in_pt:72/2.54,mm_in_pt:7.2/2.54,px_in_pt:function(){return g._base._getCachedFontMeasurements()["12pt"]/12;},pt2px:function(len){return len*g.px_in_pt();},px2pt:function(len){return len/g.px_in_pt();},normalizedLength:function(len){if(len.length===0){return 0;}if(len.length>2){var _c6=g.px_in_pt();var val=parseFloat(len);switch(len.slice(-2)){case "px":return val;case "pt":return val*_c6;case "in":return val*72*_c6;case "pc":return val*12*_c6;case "mm":return val*g.mm_in_pt*_c6;case "cm":return val*g.cm_in_pt*_c6;}}return parseFloat(len);},pathVmlRegExp:/([A-Za-z]+)|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g,pathSvgRegExp:/([A-Za-z])|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g,equalSources:function(a,b){return a&&b&&a===b;},switchTo:function(_c7){var ns=typeof _c7=="string"?g[_c7]:_c7;if(ns){arr.forEach(["Group","Rect","Ellipse","Circle","Line","Polyline","Image","Text","Path","TextPath","Surface","createSurface","fixTarget"],function(_c8){g[_c8]=ns[_c8];});if(typeof _c7=="string"){g.renderer=_c7;}else{arr.some(["svg","vml","canvas","canvasWithEvents","silverlight"],function(r){return (g.renderer=g[r]&&g[r].Surface===g.Surface?r:null);});}}}});return g;});},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/config"],function(g,_c9,has,win,_ca){var _cb=null;has.add("vml",function(_cc,_cd,_ce){_ce.innerHTML="<v:shape adj=\"1\"/>";var _cf=("adj" in _ce.firstChild);_ce.innerHTML="";return _cf;});return {load:function(id,_d0,_d1){if(_cb&&id!="force"){_d1(_cb);return;}var _d2=_ca.forceGfxRenderer,_d3=!_d2&&(_c9.isString(_ca.gfxRenderer)?_ca.gfxRenderer:"svg,vml,canvas,silverlight").split(","),_d4,_d5;while(!_d2&&_d3.length){switch(_d3.shift()){case "svg":if("SVGAngle" in win.global){_d2="svg";}break;case "vml":if(has("vml")){_d2="vml";}break;case "silverlight":try{if(has("ie")){_d4=new ActiveXObject("AgControl.AgControl");if(_d4&&_d4.IsVersionSupported("1.0")){_d5=true;}}else{if(navigator.plugins["Silverlight Plug-In"]){_d5=true;}}}catch(e){_d5=false;}finally{_d4=null;}if(_d5){_d2="silverlight";}break;case "canvas":if(win.global.CanvasRenderingContext2D){_d2="canvas";}break;}}if(_d2==="canvas"&&_ca.canvasEvents!==false){_d2="canvasWithEvents";}if(_ca.isDebug){}function _d6(){_d0(["dojox/gfx/"+_d2],function(_d7){g.renderer=_d2;_cb=_d7;_d1(_d7);});};if(_d2=="svg"&&typeof window.svgweb!="undefined"){window.svgweb.addOnLoad(_d6);}else{_d6();}}};});},"dojox/gfx/shape":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","dojo/_base/kernel","dojo/_base/sniff","dojo/on","dojo/_base/array","dojo/dom-construct","dojo/_base/Color","./matrix"],function(g,_d8,_d9,_da,has,on,arr,_db,_dc,_dd){var _de=g.shape={};_de.Shape=_d9("dojox.gfx.shape.Shape",null,{constructor:function(){this.rawNode=null;this.shape=null;this.matrix=null;this.fillStyle=null;this.strokeStyle=null;this.bbox=null;this.parent=null;this.parentMatrix=null;if(has("gfxRegistry")){var uid=_de.register(this);this.getUID=function(){return uid;};}},destroy:function(){if(has("gfxRegistry")){_de.dispose(this);}if(this.rawNode&&"__gfxObject__" in this.rawNode){this.rawNode.__gfxObject__=null;}this.rawNode=null;},getNode:function(){return this.rawNode;},getShape:function(){return this.shape;},getTransform:function(){return this.matrix;},getFill:function(){return this.fillStyle;},getStroke:function(){return this.strokeStyle;},getParent:function(){return this.parent;},getBoundingBox:function(){return this.bbox;},getTransformedBoundingBox:function(){var b=this.getBoundingBox();if(!b){return null;}var m=this._getRealMatrix(),gm=_dd;return [gm.multiplyPoint(m,b.x,b.y),gm.multiplyPoint(m,b.x+b.width,b.y),gm.multiplyPoint(m,b.x+b.width,b.y+b.height),gm.multiplyPoint(m,b.x,b.y+b.height)];},getEventSource:function(){return this.rawNode;},setClip:function(_df){this.clip=_df;},getClip:function(){return this.clip;},setShape:function(_e0){this.shape=g.makeParameters(this.shape,_e0);this.bbox=null;return this;},setFill:function(_e1){if(!_e1){this.fillStyle=null;return this;}var f=null;if(typeof (_e1)=="object"&&"type" in _e1){switch(_e1.type){case "linear":f=g.makeParameters(g.defaultLinearGradient,_e1);break;case "radial":f=g.makeParameters(g.defaultRadialGradient,_e1);break;case "pattern":f=g.makeParameters(g.defaultPattern,_e1);break;}}else{f=g.normalizeColor(_e1);}this.fillStyle=f;return this;},setStroke:function(_e2){if(!_e2){this.strokeStyle=null;return this;}if(typeof _e2=="string"||_d8.isArray(_e2)||_e2 instanceof _dc){_e2={color:_e2};}var s=this.strokeStyle=g.makeParameters(g.defaultStroke,_e2);s.color=g.normalizeColor(s.color);return this;},setTransform:function(_e3){this.matrix=_dd.clone(_e3?_dd.normalize(_e3):_dd.identity);return this._applyTransform();},_applyTransform:function(){return this;},moveToFront:function(){var p=this.getParent();if(p){p._moveChildToFront(this);this._moveToFront();}return this;},moveToBack:function(){var p=this.getParent();if(p){p._moveChildToBack(this);this._moveToBack();}return this;},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(_e4){return _e4?this.setTransform([this.matrix,_e4]):this;},applyLeftTransform:function(_e5){return _e5?this.setTransform([_e5,this.matrix]):this;},applyTransform:function(_e6){return _e6?this.setTransform([this.matrix,_e6]):this;},removeShape:function(_e7){if(this.parent){this.parent.remove(this,_e7);}return this;},_setParent:function(_e8,_e9){this.parent=_e8;return this._updateParentMatrix(_e9);},_updateParentMatrix:function(_ea){this.parentMatrix=_ea?_dd.clone(_ea):null;return this._applyTransform();},_getRealMatrix:function(){var m=this.matrix;var p=this.parent;while(p){if(p.matrix){m=_dd.multiply(p.matrix,m);}p=p.parent;}return m;}});_de._eventsProcessing={on:function(_eb,_ec){return on(this.getEventSource(),_eb,_de.fixCallback(this,g.fixTarget,_ec));},connect:function(_ed,_ee,_ef){if(_ed.substring(0,2)=="on"){_ed=_ed.substring(2);}return this.on(_ed,_ef?_d8.hitch(_ee,_ef):_ee);},disconnect:function(_f0){return _f0.remove();}};_de.fixCallback=function(_f1,_f2,_f3,_f4){if(!_f4){_f4=_f3;_f3=null;}if(_d8.isString(_f4)){_f3=_f3||_da.global;if(!_f3[_f4]){throw (["dojox.gfx.shape.fixCallback: scope[\"",_f4,"\"] is null (scope=\"",_f3,"\")"].join(""));}return function(e){return _f2(e,_f1)?_f3[_f4].apply(_f3,arguments||[]):undefined;};}return !_f3?function(e){return _f2(e,_f1)?_f4.apply(_f3,arguments):undefined;}:function(e){return _f2(e,_f1)?_f4.apply(_f3,arguments||[]):undefined;};};_d8.extend(_de.Shape,_de._eventsProcessing);_de.Container={_init:function(){this.children=[];this._batch=0;},openBatch:function(){return this;},closeBatch:function(){return this;},add:function(_f5){var _f6=_f5.getParent();if(_f6){_f6.remove(_f5,true);}this.children.push(_f5);return _f5._setParent(this,this._getRealMatrix());},remove:function(_f7,_f8){for(var i=0;i<this.children.length;++i){if(this.children[i]==_f7){if(_f8){}else{_f7.parent=null;_f7.parentMatrix=null;}this.children.splice(i,1);break;}}return this;},clear:function(_f9){var _fa;for(var i=0;i<this.children.length;++i){_fa=this.children[i];_fa.parent=null;_fa.parentMatrix=null;if(_f9){_fa.destroy();}}this.children=[];return this;},getBoundingBox:function(){if(this.children){var _fb=null;arr.forEach(this.children,function(_fc){var bb=_fc.getBoundingBox();if(bb){var ct=_fc.getTransform();if(ct){bb=_dd.multiplyRectangle(ct,bb);}if(_fb){_fb.x=Math.min(_fb.x,bb.x);_fb.y=Math.min(_fb.y,bb.y);_fb.endX=Math.max(_fb.endX,bb.x+bb.width);_fb.endY=Math.max(_fb.endY,bb.y+bb.height);}else{_fb={x:bb.x,y:bb.y,endX:bb.x+bb.width,endY:bb.y+bb.height};}}});if(_fb){_fb.width=_fb.endX-_fb.x;_fb.height=_fb.endY-_fb.y;}return _fb;}return null;},_moveChildToFront:function(_fd){for(var i=0;i<this.children.length;++i){if(this.children[i]==_fd){this.children.splice(i,1);this.children.push(_fd);break;}}return this;},_moveChildToBack:function(_fe){for(var i=0;i<this.children.length;++i){if(this.children[i]==_fe){this.children.splice(i,1);this.children.unshift(_fe);break;}}return this;}};_de.Surface=_d9("dojox.gfx.shape.Surface",null,{constructor:function(){this.rawNode=null;this._parent=null;this._nodes=[];this._events=[];},destroy:function(){arr.forEach(this._nodes,_db.destroy);this._nodes=[];arr.forEach(this._events,function(h){if(h){h.remove();}});this._events=[];this.rawNode=null;if(has("ie")){while(this._parent.lastChild){_db.destroy(this._parent.lastChild);}}else{this._parent.innerHTML="";}this._parent=null;},getEventSource:function(){return this.rawNode;},_getRealMatrix:function(){return null;},isLoaded:true,onLoad:function(_ff){},whenLoaded:function(_100,_101){var f=_d8.hitch(_100,_101);if(this.isLoaded){f(this);}else{on.once(this,"load",function(_102){f(_102);});}}});_d8.extend(_de.Surface,_de._eventsProcessing);_de.Rect=_d9("dojox.gfx.shape.Rect",_de.Shape,{constructor:function(_103){this.shape=g.getDefault("Rect");this.rawNode=_103;},getBoundingBox:function(){return this.shape;}});_de.Ellipse=_d9("dojox.gfx.shape.Ellipse",_de.Shape,{constructor:function(_104){this.shape=g.getDefault("Ellipse");this.rawNode=_104;},getBoundingBox:function(){if(!this.bbox){var _105=this.shape;this.bbox={x:_105.cx-_105.rx,y:_105.cy-_105.ry,width:2*_105.rx,height:2*_105.ry};}return this.bbox;}});_de.Circle=_d9("dojox.gfx.shape.Circle",_de.Shape,{constructor:function(_106){this.shape=g.getDefault("Circle");this.rawNode=_106;},getBoundingBox:function(){if(!this.bbox){var _107=this.shape;this.bbox={x:_107.cx-_107.r,y:_107.cy-_107.r,width:2*_107.r,height:2*_107.r};}return this.bbox;}});_de.Line=_d9("dojox.gfx.shape.Line",_de.Shape,{constructor:function(_108){this.shape=g.getDefault("Line");this.rawNode=_108;},getBoundingBox:function(){if(!this.bbox){var _109=this.shape;this.bbox={x:Math.min(_109.x1,_109.x2),y:Math.min(_109.y1,_109.y2),width:Math.abs(_109.x2-_109.x1),height:Math.abs(_109.y2-_109.y1)};}return this.bbox;}});_de.Polyline=_d9("dojox.gfx.shape.Polyline",_de.Shape,{constructor:function(_10a){this.shape=g.getDefault("Polyline");this.rawNode=_10a;},setShape:function(_10b,_10c){if(_10b&&_10b instanceof Array){this.inherited(arguments,[{points:_10b}]);if(_10c&&this.shape.points.length){this.shape.points.push(this.shape.points[0]);}}else{this.inherited(arguments,[_10b]);}return this;},_normalizePoints:function(){var p=this.shape.points,l=p&&p.length;if(l&&typeof p[0]=="number"){var _10d=[];for(var i=0;i<l;i+=2){_10d.push({x:p[i],y:p[i+1]});}this.shape.points=_10d;}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){var p=this.shape.points;var l=p.length;var t=p[0];var bbox={l:t.x,t:t.y,r:t.x,b:t.y};for(var i=1;i<l;++i){t=p[i];if(bbox.l>t.x){bbox.l=t.x;}if(bbox.r<t.x){bbox.r=t.x;}if(bbox.t>t.y){bbox.t=t.y;}if(bbox.b<t.y){bbox.b=t.y;}}this.bbox={x:bbox.l,y:bbox.t,width:bbox.r-bbox.l,height:bbox.b-bbox.t};}return this.bbox;}});_de.Image=_d9("dojox.gfx.shape.Image",_de.Shape,{constructor:function(_10e){this.shape=g.getDefault("Image");this.rawNode=_10e;},getBoundingBox:function(){return this.shape;},setStroke:function(){return this;},setFill:function(){return this;}});_de.Text=_d9(_de.Shape,{constructor:function(_10f){this.fontStyle=null;this.shape=g.getDefault("Text");this.rawNode=_10f;},getFont:function(){return this.fontStyle;},setFont:function(_110){this.fontStyle=typeof _110=="string"?g.splitFontString(_110):g.makeParameters(g.defaultFont,_110);this._setFont();return this;},getBoundingBox:function(){var bbox=null,s=this.getShape();if(s.text){bbox=g._base._computeTextBoundingBox(this);}return bbox;}});_de.Creator={createShape:function(_111){switch(_111.type){case g.defaultPath.type:return this.createPath(_111);case g.defaultRect.type:return this.createRect(_111);case g.defaultCircle.type:return this.createCircle(_111);case g.defaultEllipse.type:return this.createEllipse(_111);case g.defaultLine.type:return this.createLine(_111);case g.defaultPolyline.type:return this.createPolyline(_111);case g.defaultImage.type:return this.createImage(_111);case g.defaultText.type:return this.createText(_111);case g.defaultTextPath.type:return this.createTextPath(_111);}return null;},createGroup:function(){return this.createObject(g.Group);},createRect:function(rect){return this.createObject(g.Rect,rect);},createEllipse:function(_112){return this.createObject(g.Ellipse,_112);},createCircle:function(_113){return this.createObject(g.Circle,_113);},createLine:function(line){return this.createObject(g.Line,line);},createPolyline:function(_114){return this.createObject(g.Polyline,_114);},createImage:function(_115){return this.createObject(g.Image,_115);},createText:function(text){return this.createObject(g.Text,text);},createPath:function(path){return this.createObject(g.Path,path);},createTextPath:function(text){return this.createObject(g.TextPath,{}).setText(text);},createObject:function(_116,_117){return null;}};return _de;});},"dojox/gfx/matrix":function(){define(["./_base","dojo/_base/lang"],function(g,lang){var m=g.matrix={};var _118={};m._degToRad=function(_119){return _118[_119]||(_118[_119]=(Math.PI*_119/180));};m._radToDeg=function(_11a){return _11a/Math.PI*180;};m.Matrix2D=function(arg){if(arg){if(typeof arg=="number"){this.xx=this.yy=arg;}else{if(arg instanceof Array){if(arg.length>0){var _11b=m.normalize(arg[0]);for(var i=1;i<arg.length;++i){var l=_11b,r=m.normalize(arg[i]);_11b=new m.Matrix2D();_11b.xx=l.xx*r.xx+l.xy*r.yx;_11b.xy=l.xx*r.xy+l.xy*r.yy;_11b.yx=l.yx*r.xx+l.yy*r.yx;_11b.yy=l.yx*r.xy+l.yy*r.yy;_11b.dx=l.xx*r.dx+l.xy*r.dy+l.dx;_11b.dy=l.yx*r.dx+l.yy*r.dy+l.dy;}lang.mixin(this,_11b);}}else{lang.mixin(this,arg);}}}};lang.extend(m.Matrix2D,{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0});lang.mixin(m,{identity:new m.Matrix2D(),flipX:new m.Matrix2D({xx:-1}),flipY:new m.Matrix2D({yy:-1}),flipXY:new m.Matrix2D({xx:-1,yy:-1}),translate:function(a,b){if(arguments.length>1){return new m.Matrix2D({dx:a,dy:b});}return new m.Matrix2D({dx:a.x,dy:a.y});},scale:function(a,b){if(arguments.length>1){return new m.Matrix2D({xx:a,yy:b});}if(typeof a=="number"){return new m.Matrix2D({xx:a,yy:a});}return new m.Matrix2D({xx:a.x,yy:a.y});},rotate:function(_11c){var c=Math.cos(_11c);var s=Math.sin(_11c);return new m.Matrix2D({xx:c,xy:-s,yx:s,yy:c});},rotateg:function(_11d){return m.rotate(m._degToRad(_11d));},skewX:function(_11e){return new m.Matrix2D({xy:Math.tan(_11e)});},skewXg:function(_11f){return m.skewX(m._degToRad(_11f));},skewY:function(_120){return new m.Matrix2D({yx:Math.tan(_120)});},skewYg:function(_121){return m.skewY(m._degToRad(_121));},reflect:function(a,b){if(arguments.length==1){b=a.y;a=a.x;}var a2=a*a,b2=b*b,n2=a2+b2,xy=2*a*b/n2;return new m.Matrix2D({xx:2*a2/n2-1,xy:xy,yx:xy,yy:2*b2/n2-1});},project:function(a,b){if(arguments.length==1){b=a.y;a=a.x;}var a2=a*a,b2=b*b,n2=a2+b2,xy=a*b/n2;return new m.Matrix2D({xx:a2/n2,xy:xy,yx:xy,yy:b2/n2});},normalize:function(_122){return (_122 instanceof m.Matrix2D)?_122:new m.Matrix2D(_122);},isIdentity:function(_123){return _123.xx==1&&_123.xy==0&&_123.yx==0&&_123.yy==1&&_123.dx==0&&_123.dy==0;},clone:function(_124){var obj=new m.Matrix2D();for(var i in _124){if(typeof (_124[i])=="number"&&typeof (obj[i])=="number"&&obj[i]!=_124[i]){obj[i]=_124[i];}}return obj;},invert:function(_125){var M=m.normalize(_125),D=M.xx*M.yy-M.xy*M.yx;M=new m.Matrix2D({xx:M.yy/D,xy:-M.xy/D,yx:-M.yx/D,yy:M.xx/D,dx:(M.xy*M.dy-M.yy*M.dx)/D,dy:(M.yx*M.dx-M.xx*M.dy)/D});return M;},_multiplyPoint:function(_126,x,y){return {x:_126.xx*x+_126.xy*y+_126.dx,y:_126.yx*x+_126.yy*y+_126.dy};},multiplyPoint:function(_127,a,b){var M=m.normalize(_127);if(typeof a=="number"&&typeof b=="number"){return m._multiplyPoint(M,a,b);}return m._multiplyPoint(M,a.x,a.y);},multiplyRectangle:function(_128,rect){var M=m.normalize(_128);rect=rect||{x:0,y:0,width:0,height:0};if(m.isIdentity(M)){return {x:rect.x,y:rect.y,width:rect.width,height:rect.height};}var p0=m.multiplyPoint(M,rect.x,rect.y),p1=m.multiplyPoint(M,rect.x,rect.y+rect.height),p2=m.multiplyPoint(M,rect.x+rect.width,rect.y),p3=m.multiplyPoint(M,rect.x+rect.width,rect.y+rect.height),minx=Math.min(p0.x,p1.x,p2.x,p3.x),miny=Math.min(p0.y,p1.y,p2.y,p3.y),maxx=Math.max(p0.x,p1.x,p2.x,p3.x),maxy=Math.max(p0.y,p1.y,p2.y,p3.y);return {x:minx,y:miny,width:maxx-minx,height:maxy-miny};},multiply:function(_129){var M=m.normalize(_129);for(var i=1;i<arguments.length;++i){var l=M,r=m.normalize(arguments[i]);M=new m.Matrix2D();M.xx=l.xx*r.xx+l.xy*r.yx;M.xy=l.xx*r.xy+l.xy*r.yy;M.yx=l.yx*r.xx+l.yy*r.yx;M.yy=l.yx*r.xy+l.yy*r.yy;M.dx=l.xx*r.dx+l.xy*r.dy+l.dx;M.dy=l.yx*r.dx+l.yy*r.dy+l.dy;}return M;},_sandwich:function(_12a,x,y){return m.multiply(m.translate(x,y),_12a,m.translate(-x,-y));},scaleAt:function(a,b,c,d){switch(arguments.length){case 4:return m._sandwich(m.scale(a,b),c,d);case 3:if(typeof c=="number"){return m._sandwich(m.scale(a),b,c);}return m._sandwich(m.scale(a,b),c.x,c.y);}return m._sandwich(m.scale(a),b.x,b.y);},rotateAt:function(_12b,a,b){if(arguments.length>2){return m._sandwich(m.rotate(_12b),a,b);}return m._sandwich(m.rotate(_12b),a.x,a.y);},rotategAt:function(_12c,a,b){if(arguments.length>2){return m._sandwich(m.rotateg(_12c),a,b);}return m._sandwich(m.rotateg(_12c),a.x,a.y);},skewXAt:function(_12d,a,b){if(arguments.length>2){return m._sandwich(m.skewX(_12d),a,b);}return m._sandwich(m.skewX(_12d),a.x,a.y);},skewXgAt:function(_12e,a,b){if(arguments.length>2){return m._sandwich(m.skewXg(_12e),a,b);}return m._sandwich(m.skewXg(_12e),a.x,a.y);},skewYAt:function(_12f,a,b){if(arguments.length>2){return m._sandwich(m.skewY(_12f),a,b);}return m._sandwich(m.skewY(_12f),a.x,a.y);},skewYgAt:function(_130,a,b){if(arguments.length>2){return m._sandwich(m.skewYg(_130),a,b);}return m._sandwich(m.skewYg(_130),a.x,a.y);}});g.Matrix2D=m.Matrix2D;return m;});},"dojox/geo/openlayers/GfxLayer":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/dom-style","dojox/gfx","dojox/gfx/matrix","./Feature","./Layer"],function(_131,_132,_133,gfx,_134,_135,_136){return _131("dojox.geo.openlayers.GfxLayer",_136,{_viewport:null,constructor:function(name,_137){var s=gfx.createSurface(this.olLayer.div,100,100);this._surface=s;var vp;if(_137&&_137.viewport){vp=_137.viewport;}else{vp=s.createGroup();}this.setViewport(vp);_132.connect(this.olLayer,"onMapResize",this,"onMapResize");this.olLayer.getDataExtent=this.getDataExtent;},getViewport:function(){return this._viewport;},setViewport:function(g){if(this._viewport){this._viewport.removeShape();}this._viewport=g;this._surface.add(g);},onMapResize:function(){this._surfaceSize();},setMap:function(map){this.inherited(arguments);this._surfaceSize();},getDataExtent:function(){var ret=this._surface.getDimensions();return ret;},getSurface:function(){return this._surface;},_surfaceSize:function(){var s=this.olLayer.map.getSize();this._surface.setDimensions(s.w,s.h);},moveTo:function(_138){var s=_133.get(this.olLayer.map.layerContainerDiv);var left=parseInt(s.left);var top=parseInt(s.top);if(_138.zoomChanged||left||top){var d=this.olLayer.div;_133.set(d,{left:-left+"px",top:-top+"px"});if(this._features==null){return;}var vp=this.getViewport();vp.setTransform(_134.translate(left,top));this.inherited(arguments);}},added:function(){this.inherited(arguments);this._surfaceSize();}});});},"dojo/data/ItemFileReadStore":function(){define(["../_base/kernel","../_base/lang","../_base/declare","../_base/array","../_base/xhr","../Evented","./util/filter","./util/simpleFetch","../date/stamp"],function(_139,lang,_13a,_13b,xhr,_13c,_13d,_13e,_13f){var _140=_13a("dojo.data.ItemFileReadStore",[_13c],{constructor:function(_141){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=false;this._jsonFileUrl=_141.url;this._ccUrl=_141.url;this.url=_141.url;this._jsonData=_141.data;this.data=null;this._datatypeMap=_141.typeMap||{};if(!this._datatypeMap["Date"]){this._datatypeMap["Date"]={type:Date,deserialize:function(_142){return _13f.fromISOString(_142);}};}this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=false;this._queuedFetches=[];if(_141.urlPreventCache!==undefined){this.urlPreventCache=_141.urlPreventCache?true:false;}if(_141.hierarchical!==undefined){this.hierarchical=_141.hierarchical?true:false;}if(_141.clearOnClose){this.clearOnClose=true;}if("failOk" in _141){this.failOk=_141.failOk?true:false;}},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:false,urlPreventCache:false,failOk:false,hierarchical:true,_assertIsItem:function(item){if(!this.isItem(item)){throw new Error(this.declaredClass+": Invalid item argument.");}},_assertIsAttribute:function(_143){if(typeof _143!=="string"){throw new Error(this.declaredClass+": Invalid attribute argument.");}},getValue:function(item,_144,_145){var _146=this.getValues(item,_144);return (_146.length>0)?_146[0]:_145;},getValues:function(item,_147){this._assertIsItem(item);this._assertIsAttribute(_147);return (item[_147]||[]).slice(0);},getAttributes:function(item){this._assertIsItem(item);var _148=[];for(var key in item){if((key!==this._storeRefPropName)&&(key!==this._itemNumPropName)&&(key!==this._rootItemPropName)&&(key!==this._reverseRefMap)){_148.push(key);}}return _148;},hasAttribute:function(item,_149){this._assertIsItem(item);this._assertIsAttribute(_149);return (_149 in item);},containsValue:function(item,_14a,_14b){var _14c=undefined;if(typeof _14b==="string"){_14c=_13d.patternToRegExp(_14b,false);}return this._containsValue(item,_14a,_14b,_14c);},_containsValue:function(item,_14d,_14e,_14f){return _13b.some(this.getValues(item,_14d),function(_150){if(_150!==null&&!lang.isObject(_150)&&_14f){if(_150.toString().match(_14f)){return true;}}else{if(_14e===_150){return true;}}});},isItem:function(_151){if(_151&&_151[this._storeRefPropName]===this){if(this._arrayOfAllItems[_151[this._itemNumPropName]]===_151){return true;}}return false;},isItemLoaded:function(_152){return this.isItem(_152);},loadItem:function(_153){this._assertIsItem(_153.item);},getFeatures:function(){return this._features;},getLabel:function(item){if(this._labelAttr&&this.isItem(item)){return this.getValue(item,this._labelAttr);}return undefined;},getLabelAttributes:function(item){if(this._labelAttr){return [this._labelAttr];}return null;},filter:function(_154,_155,_156){var _157=[],i,key;if(_154.query){var _158,_159=_154.queryOptions?_154.queryOptions.ignoreCase:false;var _15a={};for(key in _154.query){_158=_154.query[key];if(typeof _158==="string"){_15a[key]=_13d.patternToRegExp(_158,_159);}else{if(_158 instanceof RegExp){_15a[key]=_158;}}}for(i=0;i<_155.length;++i){var _15b=true;var _15c=_155[i];if(_15c===null){_15b=false;}else{for(key in _154.query){_158=_154.query[key];if(!this._containsValue(_15c,key,_158,_15a[key])){_15b=false;}}}if(_15b){_157.push(_15c);}}_156(_157,_154);}else{for(i=0;i<_155.length;++i){var item=_155[i];if(item!==null){_157.push(item);}}_156(_157,_154);}},_fetchItems:function(_15d,_15e,_15f){var self=this;if(this._loadFinished){this.filter(_15d,this._getItemsArray(_15d.queryOptions),_15e);}else{if(this._jsonFileUrl!==this._ccUrl){_139.deprecated(this.declaredClass+": ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){if(this._loadInProgress){this._queuedFetches.push({args:_15d,filter:lang.hitch(self,"filter"),findCallback:lang.hitch(self,_15e)});}else{this._loadInProgress=true;var _160={url:self._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk};var _161=xhr.get(_160);_161.addCallback(function(data){try{self._getItemsFromLoadedData(data);self._loadFinished=true;self._loadInProgress=false;self.filter(_15d,self._getItemsArray(_15d.queryOptions),_15e);self._handleQueuedFetches();}catch(e){self._loadFinished=true;self._loadInProgress=false;_15f(e,_15d);}});_161.addErrback(function(_162){self._loadInProgress=false;_15f(_162,_15d);});var _163=null;if(_15d.abort){_163=_15d.abort;}_15d.abort=function(){var df=_161;if(df&&df.fired===-1){df.cancel();df=null;}if(_163){_163.call(_15d);}};}}else{if(this._jsonData){try{this._loadFinished=true;this._getItemsFromLoadedData(this._jsonData);this._jsonData=null;self.filter(_15d,this._getItemsArray(_15d.queryOptions),_15e);}catch(e){_15f(e,_15d);}}else{_15f(new Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),_15d);}}}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _164=this._queuedFetches[i],_165=_164.args,_166=_164.filter,_167=_164.findCallback;if(_166){_166(_165,this._getItemsArray(_165.queryOptions),_167);}else{this.fetchItemByIdentity(_165);}}this._queuedFetches=[];}},_getItemsArray:function(_168){if(_168&&_168.deep){return this._arrayOfAllItems;}return this._arrayOfTopLevelItems;},close:function(_169){if(this.clearOnClose&&this._loadFinished&&!this._loadInProgress){if(((this._jsonFileUrl==""||this._jsonFileUrl==null)&&(this.url==""||this.url==null))&&this.data==null){}this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=false;this._itemsByIdentity=null;this._loadInProgress=false;this._queuedFetches=[];}},_getItemsFromLoadedData:function(_16a){var _16b=false,self=this;function _16c(_16d){return (_16d!==null)&&(typeof _16d==="object")&&(!lang.isArray(_16d)||_16b)&&(!lang.isFunction(_16d))&&(_16d.constructor==Object||lang.isArray(_16d))&&(typeof _16d._reference==="undefined")&&(typeof _16d._type==="undefined")&&(typeof _16d._value==="undefined")&&self.hierarchical;};function _16e(_16f){self._arrayOfAllItems.push(_16f);for(var _170 in _16f){var _171=_16f[_170];if(_171){if(lang.isArray(_171)){var _172=_171;for(var k=0;k<_172.length;++k){var _173=_172[k];if(_16c(_173)){_16e(_173);}}}else{if(_16c(_171)){_16e(_171);}}}}};this._labelAttr=_16a.label;var i,item;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=_16a.items;for(i=0;i<this._arrayOfTopLevelItems.length;++i){item=this._arrayOfTopLevelItems[i];if(lang.isArray(item)){_16b=true;}_16e(item);item[this._rootItemPropName]=true;}var _174={},key;for(i=0;i<this._arrayOfAllItems.length;++i){item=this._arrayOfAllItems[i];for(key in item){if(key!==this._rootItemPropName){var _175=item[key];if(_175!==null){if(!lang.isArray(_175)){item[key]=[_175];}}else{item[key]=[null];}}_174[key]=key;}}while(_174[this._storeRefPropName]){this._storeRefPropName+="_";}while(_174[this._itemNumPropName]){this._itemNumPropName+="_";}while(_174[this._reverseRefMap]){this._reverseRefMap+="_";}var _176;var _177=_16a.identifier;if(_177){this._itemsByIdentity={};this._features["dojo.data.api.Identity"]=_177;for(i=0;i<this._arrayOfAllItems.length;++i){item=this._arrayOfAllItems[i];_176=item[_177];var _178=_176[0];if(!Object.hasOwnProperty.call(this._itemsByIdentity,_178)){this._itemsByIdentity[_178]=item;}else{if(this._jsonFileUrl){throw new Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+_177+"].  Value collided: ["+_178+"]");}else{if(this._jsonData){throw new Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+_177+"].  Value collided: ["+_178+"]");}}}}}else{this._features["dojo.data.api.Identity"]=Number;}for(i=0;i<this._arrayOfAllItems.length;++i){item=this._arrayOfAllItems[i];item[this._storeRefPropName]=this;item[this._itemNumPropName]=i;}for(i=0;i<this._arrayOfAllItems.length;++i){item=this._arrayOfAllItems[i];for(key in item){_176=item[key];for(var j=0;j<_176.length;++j){_175=_176[j];if(_175!==null&&typeof _175=="object"){if(("_type" in _175)&&("_value" in _175)){var type=_175._type;var _179=this._datatypeMap[type];if(!_179){throw new Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+type+"'");}else{if(lang.isFunction(_179)){_176[j]=new _179(_175._value);}else{if(lang.isFunction(_179.deserialize)){_176[j]=_179.deserialize(_175._value);}else{throw new Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");}}}}if(_175._reference){var _17a=_175._reference;if(!lang.isObject(_17a)){_176[j]=this._getItemByIdentity(_17a);}else{for(var k=0;k<this._arrayOfAllItems.length;++k){var _17b=this._arrayOfAllItems[k],_17c=true;for(var _17d in _17a){if(_17b[_17d]!=_17a[_17d]){_17c=false;}}if(_17c){_176[j]=_17b;}}}if(this.referenceIntegrity){var _17e=_176[j];if(this.isItem(_17e)){this._addReferenceToMap(_17e,item,key);}}}else{if(this.isItem(_175)){if(this.referenceIntegrity){this._addReferenceToMap(_175,item,key);}}}}}}}},_addReferenceToMap:function(_17f,_180,_181){},getIdentity:function(item){var _182=this._features["dojo.data.api.Identity"];if(_182===Number){return item[this._itemNumPropName];}else{var _183=item[_182];if(_183){return _183[0];}}return null;},fetchItemByIdentity:function(_184){var item,_185;if(!this._loadFinished){var self=this;if(this._jsonFileUrl!==this._ccUrl){_139.deprecated(this.declaredClass+": ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null&&this._jsonData==null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){if(this._loadInProgress){this._queuedFetches.push({args:_184});}else{this._loadInProgress=true;var _186={url:self._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk};var _187=xhr.get(_186);_187.addCallback(function(data){var _188=_184.scope?_184.scope:_139.global;try{self._getItemsFromLoadedData(data);self._loadFinished=true;self._loadInProgress=false;item=self._getItemByIdentity(_184.identity);if(_184.onItem){_184.onItem.call(_188,item);}self._handleQueuedFetches();}catch(error){self._loadInProgress=false;if(_184.onError){_184.onError.call(_188,error);}}});_187.addErrback(function(_189){self._loadInProgress=false;if(_184.onError){var _18a=_184.scope?_184.scope:_139.global;_184.onError.call(_18a,_189);}});}}else{if(this._jsonData){self._getItemsFromLoadedData(self._jsonData);self._jsonData=null;self._loadFinished=true;item=self._getItemByIdentity(_184.identity);if(_184.onItem){_185=_184.scope?_184.scope:_139.global;_184.onItem.call(_185,item);}}}}else{item=this._getItemByIdentity(_184.identity);if(_184.onItem){_185=_184.scope?_184.scope:_139.global;_184.onItem.call(_185,item);}}},_getItemByIdentity:function(_18b){var item=null;if(this._itemsByIdentity){if(Object.hasOwnProperty.call(this._itemsByIdentity,_18b)){item=this._itemsByIdentity[_18b];}}else{if(Object.hasOwnProperty.call(this._arrayOfAllItems,_18b)){item=this._arrayOfAllItems[_18b];}}if(item===undefined){item=null;}return item;},getIdentityAttributes:function(item){var _18c=this._features["dojo.data.api.Identity"];if(_18c===Number){return null;}else{return [_18c];}},_forceLoad:function(){var self=this;if(this._jsonFileUrl!==this._ccUrl){_139.deprecated(this.declaredClass+": ","To change the url, set the url property of the store,"+" not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0");this._ccUrl=this._jsonFileUrl;this.url=this._jsonFileUrl;}else{if(this.url!==this._ccUrl){this._jsonFileUrl=this.url;this._ccUrl=this.url;}}if(this.data!=null){this._jsonData=this.data;this.data=null;}if(this._jsonFileUrl){var _18d={url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:true};var _18e=xhr.get(_18d);_18e.addCallback(function(data){try{if(self._loadInProgress!==true&&!self._loadFinished){self._getItemsFromLoadedData(data);self._loadFinished=true;}else{if(self._loadInProgress){throw new Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}}}catch(e){throw e;}});_18e.addErrback(function(_18f){throw _18f;});}else{if(this._jsonData){self._getItemsFromLoadedData(self._jsonData);self._jsonData=null;self._loadFinished=true;}}}});lang.extend(_140,_13e);return _140;});},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(lang){var _190={};lang.setObject("dojo.data.util.filter",_190);_190.patternToRegExp=function(_191,_192){var rxp="^";var c=null;for(var i=0;i<_191.length;i++){c=_191.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_191.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_192){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};return _190;});},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(lang,_193,_194){var _195={};lang.setObject("dojo.data.util.simpleFetch",_195);_195.errorHandler=function(_196,_197){if(_197.onError){var _198=_197.scope||_193.global;_197.onError.call(_198,_196,_197);}};_195.fetchHandler=function(_199,_19a){var _19b=_19a.abort||null,_19c=false,_19d=_19a.start?_19a.start:0,_19e=(_19a.count&&(_19a.count!==Infinity))?(_19d+_19a.count):_199.length;_19a.abort=function(){_19c=true;if(_19b){_19b.call(_19a);}};var _19f=_19a.scope||_193.global;if(!_19a.store){_19a.store=this;}if(_19a.onBegin){_19a.onBegin.call(_19f,_199.length,_19a);}if(_19a.sort){_199.sort(_194.createSortFunction(_19a.sort,this));}if(_19a.onItem){for(var i=_19d;(i<_199.length)&&(i<_19e);++i){var item=_199[i];if(!_19c){_19a.onItem.call(_19f,item,_19a);}}}if(_19a.onComplete&&!_19c){var _1a0=null;if(!_19a.onItem){_1a0=_199.slice(_19d,_19e);}_19a.onComplete.call(_19f,_1a0,_19a);}};_195.fetch=function(_1a1){_1a1=_1a1||{};if(!_1a1.store){_1a1.store=this;}this._fetchItems(_1a1,lang.hitch(this,"fetchHandler"),lang.hitch(this,"errorHandler"));return _1a1;};return _195;});},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(lang){var _1a2={};lang.setObject("dojo.data.util.sorter",_1a2);_1a2.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_1a2.createSortFunction=function(_1a3,_1a4){var _1a5=[];function _1a6(attr,dir,comp,s){return function(_1a7,_1a8){var a=s.getValue(_1a7,attr);var b=s.getValue(_1a8,attr);return dir*comp(a,b);};};var _1a9;var map=_1a4.comparatorMap;var bc=_1a2.basicComparator;for(var i=0;i<_1a3.length;i++){_1a9=_1a3[i];var attr=_1a9.attribute;if(attr){var dir=(_1a9.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_1a5.push(_1a6(attr,dir,comp,_1a4));}}return function(rowA,rowB){var i=0;while(i<_1a5.length){var ret=_1a5[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _1a2;});},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(lang,_1aa){var _1ab={};lang.setObject("dojo.date.stamp",_1ab);_1ab.fromISOString=function(_1ac,_1ad){if(!_1ab._isoRegExp){_1ab._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/;}var _1ae=_1ab._isoRegExp.exec(_1ac),_1af=null;if(_1ae){_1ae.shift();if(_1ae[1]){_1ae[1]--;}if(_1ae[6]){_1ae[6]*=1000;}if(_1ad){_1ad=new Date(_1ad);_1aa.forEach(_1aa.map(["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],function(prop){return _1ad["get"+prop]();}),function(_1b0,_1b1){_1ae[_1b1]=_1ae[_1b1]||_1b0;});}_1af=new Date(_1ae[0]||1970,_1ae[1]||0,_1ae[2]||1,_1ae[3]||0,_1ae[4]||0,_1ae[5]||0,_1ae[6]||0);if(_1ae[0]<100){_1af.setFullYear(_1ae[0]||1970);}var _1b2=0,_1b3=_1ae[7]&&_1ae[7].charAt(0);if(_1b3!="Z"){_1b2=((_1ae[8]||0)*60)+(Number(_1ae[9])||0);if(_1b3!="-"){_1b2*=-1;}}if(_1b3){_1b2-=_1af.getTimezoneOffset();}if(_1b2){_1af.setTime(_1af.getTime()+_1b2*60000);}}return _1af;};_1ab.toISOString=function(_1b4,_1b5){var _1b6=function(n){return (n<10)?"0"+n:n;};_1b5=_1b5||{};var _1b7=[],_1b8=_1b5.zulu?"getUTC":"get",date="";if(_1b5.selector!="time"){var year=_1b4[_1b8+"FullYear"]();date=["0000".substr((year+"").length)+year,_1b6(_1b4[_1b8+"Month"]()+1),_1b6(_1b4[_1b8+"Date"]())].join("-");}_1b7.push(date);if(_1b5.selector!="date"){var time=[_1b6(_1b4[_1b8+"Hours"]()),_1b6(_1b4[_1b8+"Minutes"]()),_1b6(_1b4[_1b8+"Seconds"]())].join(":");var _1b9=_1b4[_1b8+"Milliseconds"]();if(_1b5.milliseconds){time+="."+(_1b9<100?"0":"")+_1b6(_1b9);}if(_1b5.zulu){time+="Z";}else{if(_1b5.selector!="time"){var _1ba=_1b4.getTimezoneOffset();var _1bb=Math.abs(_1ba);time+=(_1ba>0?"-":"+")+_1b6(Math.floor(_1bb/60))+":"+_1b6(_1bb%60);}}_1b7.push(time);}return _1b7.join("T");};return _1ab;});},"demos/shippingRoutes/src/PortRenderer":function(){define(["dojo/_base/kernel","dojo/_base/declare","./EcrRenderer","dojox/geo/openlayers/GeometryFeature","dojox/geo/openlayers/Point"],function(dojo,_1bc,_1bd,_1be,_1bf){return _1bc(_1bd,{constructor:function(opts,_1c0){},_renderItem:function(o,item){var gf=null;if(o.type=="circle"){var _1c1=this.getCoordinates(item);var g=new _1bf({x:_1c1[0],y:_1c1[1]});gf=new _1be(g);gf.setShapeProperties({r:o.radius});}return gf;}});});},"demos/shippingRoutes/src/EcrRenderer":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/array","dojo/_base/lang"],function(dojo,_1c2,arr,lang){return _1c2(null,{constructor:function(opts,_1c3){this._options=opts;this._context=_1c3;},render:function(item){var o=this._options;return this._render(o,item);},_render:function(o,item){if(o instanceof Array){var _1c4=[];o.sort(function(i1,i2){var d1=i1.depth;var d2=i2.depth;if(d1!=undefined&&d2!=undefined){var id1=parseInt(d1);var id2=parseInt(d2);if(id1==id2){return 0;}if(id1<id2){return -1;}return 1;}return 0;});arr.forEach(o,function(oi,_1c5,_1c6){var co=lang.clone(oi);this._callFunctions(co,item);this._solveReferences(co,item);var f=this._render(co,item);if(f!=null){f.setStroke(co.stroke);f.setFill(co.fill);_1c4.push(f);}},this);return _1c4;}var co=lang.clone(o);this._callFunctions(co,item);this._solveReferences(co,item);var gf=this._renderItem(co,item);if(gf!=null){gf.setStroke(co.stroke);gf.setFill(co.fill);}return gf;},_renderItem:function(o,item){return null;},_callFunctions:function(o,item){for(var prop in o){if(o.hasOwnProperty(prop)){var v=o[prop];if(typeof v=="function"){o[prop]=v.call(item,this._context);}else{if(typeof v=="object"){this._callFunctions(v,item);}}}}},getContext:function(){return this._context;},getContextValue:function(name){if(this._context){return this._context[name];}return undefined;},getValue:function(item,_1c7){var s=this.getContextValue("store");if((s!=undefined)&&s.isItem(item)){return s.getValue(item,_1c7);}if(item.hasOwnProperty(_1c7)){return item[_1c7];}return undefined;},_coords:[0,0],getCoordinates:function(item){var lon=this.getValue(item,"longitude");var lat=this.getValue(item,"latitude");var flon=parseFloat(lon);var flat=parseFloat(lat);var a=this._coords;a[0]=flon;a[1]=flat;return a;},_findAttributeValue:function(o,a,item){var v=undefined;if(item!=null){v=this.getValue(item,a);}if(v!=undefined){return v;}v=o[a];if(v!=undefined){return v;}for(var i in o){var ov=o[i];if(typeof (ov)=="object"){var vv=this._findAttributeValue(ov,a,null);if(vv!=undefined){return vv;}}}return undefined;},_solveReferences:function(o,item){this.__solveReferences(o,o,item);},__solveReferences:function(oo,o,item){for(var a in o){var v=o[a];if(typeof (v)=="object"){this.__solveReferences(oo,v,item);}if(typeof (v)=="string"){var re=/{(.*)}/;if(v.match(re)){v=v.replace(re,"$1");var r=this._findAttributeValue(oo,v,item);if(r!=undefined){var ps=parseFloat(r);if(isNaN(ps)){o[a]=r;}else{o[a]=ps;}}}}}}});});},"dojox/geo/openlayers/GeometryFeature":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojox/gfx/matrix","./Point","./LineString","./Collection","./Feature"],function(_1c8,_1c9,lang,_1ca,_1cb,_1cc,_1cd,_1ce){return _1c8("dojox.geo.openlayers.GeometryFeature",_1ce,{constructor:function(_1cf){this._geometry=_1cf;this._shapeProperties={};this._fill=null;this._stroke=null;},_createCollection:function(g){var _1d0=this.getLayer();var s=_1d0.getSurface();var c=this.createShape(s,g);var vp=_1d0.getViewport();vp.add(c);return c;},_getCollectionShape:function(g){var s=g.shape;if(s==null){s=this._createCollection(g);g.shape=s;}return s;},renderCollection:function(g){if(g==undefined){g=this._geometry;}s=this._getCollectionShape(g);var prop=this.getShapeProperties();s.setShape(prop);_1c9.forEach(g.coordinates,function(item){if(item instanceof _1cb){this.renderPoint(item);}else{if(item instanceof _1cc){this.renderLineString(item);}else{if(item instanceof _1cd){this.renderCollection(item);}else{throw new Error();}}}},this);this._applyStyle(g);},render:function(g){if(g==undefined){g=this._geometry;}if(g instanceof _1cb){this.renderPoint(g);}else{if(g instanceof _1cc){this.renderLineString(g);}else{if(g instanceof _1cd){this.renderCollection(g);}else{throw new Error();}}}},getShapeProperties:function(){return this._shapeProperties;},setShapeProperties:function(s){this._shapeProperties=s;return this;},createShape:function(s,g){if(!g){g=this._geometry;}var _1d1=null;if(g instanceof _1cb){_1d1=s.createCircle();}else{if(g instanceof _1cc){_1d1=s.createPolyline();}else{if(g instanceof _1cd){var grp=s.createGroup();_1c9.forEach(g.coordinates,function(item){var shp=this.createShape(s,item);grp.add(shp);},this);_1d1=grp;}else{throw new Error();}}}return _1d1;},getShape:function(){var g=this._geometry;if(!g){return null;}if(g.shape){return g.shape;}this.render();return g.shape;},_createPoint:function(g){var _1d2=this.getLayer();var s=_1d2.getSurface();var c=this.createShape(s,g);var vp=_1d2.getViewport();vp.add(c);return c;},_getPointShape:function(g){var s=g.shape;if(s==null){s=this._createPoint(g);g.shape=s;}return s;},renderPoint:function(g){if(g==undefined){g=this._geometry;}var _1d3=this.getLayer();var map=_1d3.getDojoMap();s=this._getPointShape(g);var prop=lang.mixin({},this._defaults.pointShape);prop=lang.mixin(prop,this.getShapeProperties());s.setShape(prop);var from=this.getCoordinateSystem();var p=map.transform(g.coordinates,from);var a=this._getLocalXY(p);var cx=a[0];var cy=a[1];var tr=_1d3.getViewport().getTransform();if(tr){s.setTransform(_1ca.translate(cx-tr.dx,cy-tr.dy));}this._applyStyle(g);},_createLineString:function(g){var _1d4=this.getLayer();var s=_1d4._surface;var _1d5=this.createShape(s,g);var vp=_1d4.getViewport();vp.add(_1d5);g.shape=_1d5;return _1d5;},_getLineStringShape:function(g){var s=g.shape;if(s==null){s=this._createLineString(g);g.shape=s;}return s;},renderLineString:function(g){if(g==undefined){g=this._geometry;}var _1d6=this.getLayer();var map=_1d6.getDojoMap();var lss=this._getLineStringShape(g);var from=this.getCoordinateSystem();var _1d7=new Array(g.coordinates.length);var tr=_1d6.getViewport().getTransform();_1c9.forEach(g.coordinates,function(c,i,_1d8){var p=map.transform(c,from);var a=this._getLocalXY(p);if(tr){a[0]-=tr.dx;a[1]-=tr.dy;}_1d7[i]={x:a[0],y:a[1]};},this);var prop=lang.mixin({},this._defaults.lineStringShape);prop=lang.mixin(prop,this.getShapeProperties());prop=lang.mixin(prop,{points:_1d7});lss.setShape(prop);this._applyStyle(g);},_applyStyle:function(g){if(!g||!g.shape){return;}var f=this.getFill();var fill;if(!f||lang.isString(f)||lang.isArray(f)){fill=f;}else{fill=lang.mixin({},this._defaults.fill);fill=lang.mixin(fill,f);}var s=this.getStroke();var _1d9;if(!s||lang.isString(s)||lang.isArray(s)){_1d9=s;}else{_1d9=lang.mixin({},this._defaults.stroke);_1d9=lang.mixin(_1d9,s);}this._applyRecusiveStyle(g,_1d9,fill);},_applyRecusiveStyle:function(g,_1da,fill){var shp=g.shape;if(shp.setFill){shp.setFill(fill);}if(shp.setStroke){shp.setStroke(_1da);}if(g instanceof _1cd){_1c9.forEach(g.coordinates,function(i){this._applyRecusiveStyle(i,_1da,fill);},this);}},setStroke:function(s){this._stroke=s;return this;},getStroke:function(){return this._stroke;},setFill:function(f){this._fill=f;return this;},getFill:function(){return this._fill;},remove:function(){var g=this._geometry;var shp=g.shape;g.shape=null;if(shp){shp.removeShape();}if(g instanceof _1cd){_1c9.forEach(g.coordinates,function(i){this.remove(i);},this);}},_defaults:{fill:null,stroke:null,pointShape:{r:30},lineStringShape:null}});});},"dojox/geo/openlayers/Point":function(){define(["dojo/_base/declare","./Geometry"],function(_1db,_1dc){return _1db("dojox.geo.openlayers.Point",_1dc,{setPoint:function(p){this.coordinates=p;},getPoint:function(){return this.coordinates;}});});},"dojox/geo/openlayers/Geometry":function(){define(["dojo/_base/declare"],function(_1dd){return _1dd("dojox.geo.openlayers.Geometry",null,{coordinates:null,shape:null,constructor:function(_1de){this.coordinates=_1de;}});});},"dojox/geo/openlayers/LineString":function(){define(["dojo/_base/declare","./Geometry"],function(_1df,_1e0){return _1df("dojox.geo.openlayers.LineString",_1e0,{setPoints:function(p){this.coordinates=p;},getPoints:function(){return this.coordinates;}});});},"dojox/geo/openlayers/Collection":function(){define(["dojo/_base/declare","./Geometry"],function(_1e1,_1e2){return _1e1("dojox.geo.openlayers.Collection",_1e2,{coordinates:null,setGeometries:function(g){this.coordinates=g;},getGeometries:function(){return this.coordinates;}});});},"demos/shippingRoutes/src/LegsRenderer":function(){define(["dojo/_base/declare","dojo/_base/array","./EcrRenderer","dojox/geo/openlayers/GeometryFeature","dojox/geo/openlayers/LineString","dojox/geo/openlayers/Point","dojox/geo/openlayers/GreatCircle"],function(_1e3,arr,_1e4,_1e5,_1e6,_1e7,_1e8){return _1e3(_1e4,{constructor:function(opts,_1e9){this._geodetic=false;this._greatCircle=null;},setGeodetic:function(_1ea){this._geodetic=_1ea;},getGeodetic:function(){return this._geodetic;},_renderItem:function(o,item){var gf=null;if(o.type=="polyline"){var _1eb=this.getContextValue("store");var _1ec=_1eb.getValues(item,"stops");var pts=[];var _1ed=null;arr.forEach(_1ec,function(it,_1ee,_1ef){if(_1eb.isItem(it)){var port=this.getValue(it,"port");var _1f0=this.getCoordinates(port);if(this.getGeodetic()){if(_1ed!=null){var _1f1={x:_1f0[0],y:_1f0[1]};var _1f2=_1e8.toPointArray(_1ed,_1f1,5);pts=pts.concat(_1f2);}}else{var p=new _1e7({x:_1f0[0],y:_1f0[1]});pts.push(p);}_1ed={x:_1f0[0],y:_1f0[1]};}},this);var g=new _1e6(pts);gf=new _1e5(g);}return gf;}});});},"dojox/geo/openlayers/GreatCircle":function(){define(["dojo/_base/lang","./_base","./GeometryFeature"],function(lang,_1f3,_1f4){var gc=_1f3.GreatCircle={toPointArray:function(p1,p2,_1f5){var _1f6=p1.x;var _1f7=p2.x;var sl=Math.min(_1f6,_1f7);var el=Math.max(_1f6,_1f7);var d2r=this.DEG2RAD;var lat1=p1.y*d2r;var lon1=p1.x*d2r;var lat2=p2.y*d2r;var lon2=p2.x*d2r;if(Math.abs(lon1-lon2)<=this.TOLERANCE){var l=Math.min(lon1,lon2);lon2=l+Math.PI;}if(Math.abs(lon2-lon1)==Math.PI){if(lat1+lat2==0){lat2+=Math.PI/180000000;}}var lon=sl*d2r;var elon=el*d2r;var incr=_1f5*d2r;var wp=[];var k=0;var r2d=this.RAD2DEG;while(lon<=elon){lat=Math.atan((Math.sin(lat1)*Math.cos(lat2)*Math.sin(lon-lon2)-Math.sin(lat2)*Math.cos(lat1)*Math.sin(lon-lon1))/(Math.cos(lat1)*Math.cos(lat2)*Math.sin(lon1-lon2)));var p={x:lon*r2d,y:lat*r2d};wp[k++]=p;if(lon<elon&&(lon+incr)>=elon){lon=elon;}else{lon=lon+incr;}}return wp;},toLineString:function(p1,p2,_1f8){var wp=this.toPointArray(p1,p2,_1f8);var ls=new OpenLayers.Geometry.LineString(wp);return ls;},toGeometryFeature:function(p1,p2,_1f9){var ls=this.toLineString(p1,p2,_1f9);return new _1f4(ls);},DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,TOLERANCE:0.00001};return gc;});}}});var _ecr;require(["dojo/ready","demos/shippingRoutes/src/Ecr"],function(_1fa,Ecr){_1fa(function(){_ecr=new Ecr();});});