//>>built
define("demos/fonts/src/pie",["dojo","dijit","dojox","dojo/require!dojox/gfx,dojox/gfx/VectorText,dojox/gfx/utils"],function(_1,_2,_3){_1.provide("demos.fonts.src.pie");_1.require("dojox.gfx");_1.require("dojox.gfx.VectorText");_1.require("dojox.gfx.utils");(function(){demos.fonts.src.pie=function(_4,_5,_6,_7){_7=_7||{};this.font=_5;this.data=_6||[];this.stroke={color:_7.stroke||"white",width:1};this.fill=_7.fill||"#40b337";this.radius=_7.radius||112;this.center=_7.center||this.radius+(this.stroke.width*2);this.width=_7.width||this.center*2;this.height=_7.height||this.center*2;this.domNode=_4||null;this.rotation=_7.rotation||0;this.mainFill=_7.main||"#364c42";this.surface=null;this.otherData=[];};_1.extend(demos.fonts.src.pie,{findScale:function(_8,w){var g=_1.map(this.font._normalize(_8).split(""),function(_9){return this.font.glyphs[_9]||{path:"",xAdvance:this.font.advance.missing.x};},this);var cw=0;for(var i=0;i<g.length;i++){var tw=g[i].xAdvance;if(i+1<g.length&&g[i].kern&&g[i+1]&&g[i+1].code&&g[i].kern[g[i+1].code]){tw+=g[i].kern[g[i+1].code].x;}cw+=tw;}return this.font._round(w/cw);},draw:function(d){var m=_3.gfx.matrix,_a=(2*Math.PI)/360;var r=this.radius,c=this.center,_b=(this.data=d||this.data);if(!this.surface&&this.domNode){this.surface=_3.gfx.createSurface(this.domNode,this.width,this.height);}this.surface.clear();var _c=0,_d=-1,_e=0,_f=5,_10,_11,pct=0;_1.forEach(_b,function(_12){_c+=_12.value;});_1.forEach(_b,function(_13,i){_13.label=_13.label.toUpperCase();_13.pct=Math.round(_13.value*(100/_c));pct+=_13.pct;if(_13.pct>_e){_e=_13.pct;_d=i;}if(_13.pct<_f){if(!_10){_10={label:"Other",pct:0,value:0,isOther:true};}_10.pct+=_13.pct;_10.value+=_13.value;this.otherData.push(_13);}},this);if(pct<100){_b[_d].pct+=100-pct;}if(_10){_b.push(_10);_10.label=_10.label.toUpperCase();}var g=this.surface.createGroup(),mm=m.rotategAt(this.rotation,c,c);g.setTransform(mm);g.createCircle({r:r,cx:c,cy:c}).setStroke(this.stroke).setFill(this.mainFill);var _14=0,_15=(360*(100-_b[_d].pct))/100,_16=(360-_15)/2;_14=_16,_15=(_14+(360*(100-_b[_d].pct))/100)%360;var _17=g.createGroup(),_18={text:_b[_d].label,x:0,y:0,width:r/1.65,height:r/1.65,align:"start",fitting:_3.gfx.vectorFontFitting.NONE},_19={size:"10px"};var txt=this.font.draw(_17,_18,_19,this.stroke.color),_1a=this.findScale(_b[_d].label,r/1.65),_1b=Math.round(this.font.viewbox.height*_1a)/2;if(this.rotation>90&&this.rotation<270){txt.setTransform(new _3.gfx.Matrix2D([m.translate((r*2)-10,c+_1b),m.scale(_1a),m.rotateg(180)]));}else{txt.setTransform(new _3.gfx.Matrix2D([m.translate((r*2)-6-(r/1.65),c-_1b),m.scale(_1a)]));}var pct=this.font.draw(_17,{text:(_b[_d].pct).toString(),width:24,height:24,align:"start",fitting:_3.gfx.vectorFontFitting.FLOW,x:0,y:0},_19,this.stroke.color);if(this.rotation>90&&this.rotation<270){pct.setTransform(new _3.gfx.Matrix2D([m.translate(r+18,c+5),pct.getTransform(),m.rotateg(180)]));}else{pct.setTransform(new _3.gfx.Matrix2D([m.translate(r+12,c-5),pct.getTransform()]));}var _1c=g.createGroup(),st=Math.min(_14,_15),ed=Math.max(_14,_15);var arc=_1c.createPath({}).moveTo(c,c).lineTo(c+r*Math.cos(st*_a),c+r*Math.sin(st*_a)).arcTo(r,r,0,(Math.max(_14,_15)-Math.min(_14,_15)>180),true,{x:c+r*Math.cos(ed*_a),y:c+r*Math.sin(ed*_a)}).lineTo(c,c).closePath().setStroke(this.stroke).setFill(this.fill);var _1d=_14;for(var i=_d+1;(i%_b.length)!=_d;i++){var d=_b[i%_b.length],v=d.pct,a=_1d;if(d.pct<_f&&!d.isOther){continue;}_1d+=(d.pct*360)/100;if(i%_b.length!=_d-1){_1c.createLine({x1:c,y1:c,x2:c+r-8,y2:c}).setStroke(this.stroke).setTransform(m.rotategAt(_1d,c,c));}var _1e=(a+1)*_a;var _1f=(_1d-1)*_a;var _20=_1d-((_1d-a)/2);var _21=_20*_a;if(d.isOther){this.otherPoint={x:Math.round(c+(38*Math.cos(_21+(this.rotation*_a)))),y:Math.round(c+(38*Math.sin(_21+(this.rotation*_a))))};this.otherEnds={small:{x:c+r*Math.cos(_1e),y:c+r*Math.sin(_1e)},large:{x:c+r*Math.cos(_1f),y:c+r*Math.sin(_1f)}};var _22=_1d+this.rotation;if(_22<=90){this.otherDirection="SE";}else{if(_22>90&&_22<=180){this.otherDirection="SW";}else{if(_22>180&&_22<=270){this.otherDirection="NW";}else{this.otherDirection="NE";}}}}var _23={x1:c+((r*0.36)*Math.cos(_21)),y1:c+((r*0.36)*Math.sin(_21)),x2:c+((r-16)*Math.cos(_21)),y2:c+((r-16)*Math.sin(_21))};_23.dx=_23.x2-_23.x1,_23.dy=_23.y2-_23.y1;var _24={x1:c+(32*Math.cos(_1e)),x2:c+(32*Math.cos(_1f)),y1:c+(32*Math.sin(_1e)),y2:c+(32*Math.sin(_1f))};_24.dx=_24.x2-_24.x1,_24.dy=_24.y2-_24.y1;var _25={x1:c+((r*0.4)*Math.cos(_1e)),x2:c+((r*0.4)*Math.cos(_1f)),y1:c+((r*0.4)*Math.sin(_1e)),y2:c+((r*0.4)*Math.sin(_1f))};_25.dx=_25.x2-_25.x1,_25.dy=_25.y2-_25.y1;var _26=Math.sqrt(_23.dx*_23.dx+_23.dy*_23.dy);var _27=Math.sqrt(_25.dx*_25.dx+_25.dy*_25.dy);var _28=Math.sqrt(_24.dx*_24.dx+_24.dy*_24.dy);var _29=_1c.createGroup(),_18={text:_1.trim(d.label),x:0,y:0,width:r,height:r,align:"start",fitting:_3.gfx.vectorFontFitting.NONE},_19={size:"8px"};_29.setTransform(m.rotategAt(_1d-((_1d-a)/2),c,c));var pct=this.font.draw(_29,{text:(d.pct).toString(),width:12,height:12,align:"start",fitting:_3.gfx.vectorFontFitting.FLOW,x:0,y:0},_19,this.stroke.color);var _2a=0;if(_28<8){_2a=_28/this.font.viewbox.height;}if(_20>=90-this.rotation&&_20<=270-this.rotation){_2b=new _3.gfx.Matrix2D([m.translate(r+24,c+(_2a?Math.round(this.font.viewbox.height*_2a)/2:3)),_2a?m.scale(_2a):pct.getTransform(),m.rotateg(180)]);}else{_2b=new _3.gfx.Matrix2D([m.translate(r+20,c-(_2a?Math.round(this.font.viewbox.height*_2a)/2:3)),_2a?m.scale(_2a):pct.getTransform()]);}pct.setTransform(_2b);var txt=this.font.draw(_29,_18,_19,this.stroke.color),_1a=this.findScale(d.label,r/1.65),_1b=Math.round(this.font.viewbox.height*_1a)/2,_2c=this.font.getWidth(d.label,_1a);if(Math.round(this.font.viewbox.height*_1a)>_27){_1a=_27/this.font.viewbox.height;_1b=Math.round(this.font.viewbox.height*_1a)/2;_2c=this.font.getWidth(d.label,_1a);}if(_20>=90-this.rotation&&_20<=270-this.rotation){var _2b=new _3.gfx.Matrix2D([m.translate(r*2-10,c+_1b),m.scale(_1a),m.rotateg(180)]);}else{var _2b=new _3.gfx.Matrix2D([m.translate((r*2)-_2c-6,c-_1b),m.scale(_1a)]);}txt.setTransform(_2b);}return g;}});})();});