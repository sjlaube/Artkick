//>>built
define("dojox/calendar/CalendarBase",["dojo/_base/declare","dojo/_base/sniff","dojo/_base/event","dojo/_base/lang","dojo/_base/array","dojo/cldr/supplemental","dojo/dom","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/date","dojo/date/locale","dojo/_base/fx","dojo/fx","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","./StoreMixin","dojox/widget/_Invalidating","dojox/widget/Selection","dojox/calendar/time","dojo/i18n!./nls/buttons"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,fx,on,_e,_f,_10,_11,_12,_13,_14,_15){return _1("dojox.calendar.CalendarBase",[_e,_f,_10,_11,_12,_13],{baseClass:"dojoxCalendar",datePackage:_b,startDate:null,endDate:null,date:null,minDate:null,maxDate:null,dateInterval:"week",dateIntervalSteps:1,viewContainer:null,firstDayOfWeek:-1,formatItemTimeFunc:null,editable:true,moveEnabled:true,resizeEnabled:true,columnView:null,matrixView:null,columnViewProps:null,matrixViewProps:null,createOnGridClick:false,createItemFunc:null,currentView:null,_currentViewIndex:-1,views:null,_calendar:"gregorian",constructor:function(_16){this.views=[];this.invalidatingProperties=["store","items","startDate","endDate","views","date","minDate","maxDate","dateInterval","dateIntervalSteps","firstDayOfWeek"];_16=_16||{};this._calendar=_16.datePackage?_16.datePackage.substr(_16.datePackage.lastIndexOf(".")+1):this._calendar;this.dateModule=_16.datePackage?_4.getObject(_16.datePackage,false):_b;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=_16.datePackage?_4.getObject(_16.datePackage+".locale",false):_c;this.invalidateRendering();},buildRendering:function(){this.inherited(arguments);if(this.views==null||this.views.length==0){this.set("views",this._createDefaultViews());}},_applyAttributes:function(){this._applyAttr=true;this.inherited(arguments);delete this._applyAttr;},_setStartDateAttr:function(_17){this._set("startDate",_17);this._timeRangeInvalidated=true;this._startDateChanged=true;},_setEndDateAttr:function(_18){this._set("endDate",_18);this._timeRangeInvalidated=true;this._endDateChanged=true;},_setDateAttr:function(_19){this._set("date",_19);this._timeRangeInvalidated=true;this._dateChanged=true;},_setDateIntervalAttr:function(_1a){this._set("dateInterval",_1a);this._timeRangeInvalidated=true;},_setDateIntervalStepsAttr:function(_1b){this._set("dateIntervalSteps",_1b);this._timeRangeInvalidated=true;},_setFirstDayOfWeekAttr:function(_1c){this._set("firstDayOfWeek",_1c);if(this.get("date")!=null&&this.get("dateInterval")=="week"){this._timeRangeInvalidated=true;}},_setTextDirAttr:function(_1d){_5.forEach(this.views,function(_1e){_1e.set("textDir",_1d);});},refreshRendering:function(){this.inherited(arguments);this._validateProperties();},_refreshItemsRendering:function(){if(this.currentView){this.currentView._refreshItemsRendering();}},resize:function(){if(this.currentView){this.currentView.resize();}},_validateProperties:function(){var cal=this.dateModule;var _1f=this.get("startDate");var _20=this.get("endDate");var _21=this.get("date");if(this.firstDayOfWeek<-1||this.firstDayOfWeek>6){this._set("firstDayOfWeek",0);}var _22=this.get("minDate");var _23=this.get("maxDate");if(_22&&_23){if(cal.compare(_22,_23)>0){var t=_22;this._set("minDate",_23);this._set("maxDate",t);}}if(_21==null&&(_1f!=null||_20!=null)){if(_1f==null){_1f=new this.dateClassObj();this._set("startDate",_1f);this._timeRangeInvalidated=true;}if(_20==null){_20=new this.dateClassObj();this._set("endDate",_20);this._timeRangeInvalidated=true;}if(cal.compare(_1f,_20)>0){_20=cal.add(_1f,"day",1);this._set("endDate",_20);this._timeRangeInvalidated=true;}}else{if(this.date==null){this._set("date",new this.dateClassObj());this._timeRangeInvalidated=true;}var _24=this.get("dateInterval");if(_24!="day"&&_24!="week"&&_24!="month"){this._set("dateInterval","day");this._timeRangeInvalidated=true;}var dis=this.get("dateIntervalSteps");if(_4.isString(dis)){dis=parseInt(dis);this._set("dateIntervalSteps",dis);}if(dis<=0){this.set("dateIntervalSteps",1);this._timeRangeInvalidated=true;}}if(this._timeRangeInvalidated){this._timeRangeInvalidated=false;var _25=this.computeTimeInterval();if(this._timeInterval==null||cal.compare(this._timeInterval[0],_25[0])!=0||cal.compare(this._timeInterval[1],_25[1])!=0){if(this._dateChanged){this._lastValidDate=this.get("date");this._dateChanged=false;}else{if(this._startDateChanged||this._endDateChanged){this._lastValidStartDate=this.get("startDate");this._lastValidEndDate=this.get("endDate");this._startDateChanged=false;this._endDateChanged=false;}}this.onTimeIntervalChange({oldStartTime:this._timeInterval==null?null:this._timeInterval[0],oldEndTime:this._timeInterval==null?null:this._timeInterval[1],startTime:_25[0],endTime:_25[1]});}else{if(this._dateChanged){this._dateChanged=false;if(this.lastValidDate!=null){this._set("date",this.lastValidDate);}}else{if(this._startDateChanged||this._endDateChanged){this._startDateChanged=false;this._endDateChanged=false;this._set("startDate",this._lastValidStartDate);this._set("endDate",this._lastValidEndDate);}}return;}this._timeInterval=_25;var _26=this.dateModule.difference(this._timeInterval[0],this._timeInterval[1],"day");var _27=this._computeCurrentView(_25[0],_25[1],_26);var _28=_5.indexOf(this.views,_27);if(_27==null||_28==-1){return;}this._performViewTransition(_27,_28,_25,_26);}},_performViewTransition:function(_29,_2a,_2b,_2c){var _2d=this.currentView;if(this.animateRange&&(!_2("ie")||_2("ie")>8)){if(_2d){_2d.beforeDeactivate();var ltr=this.isLeftToRight();var _2e=this._animRangeInDir=="left"||this._animRangeInDir==null;var _2f=this._animRangeOutDir=="left"||this._animRangeOutDir==null;this._animateRange(this.currentView.domNode,_2f&&ltr,false,0,_2f?-100:100,_4.hitch(this,function(){_2d.afterDeactivate();_29.beforeActivate();this.animateRangeTimer=setTimeout(_4.hitch(this,function(){this._applyViewChange(_29,_2a,_2b,_2c);this._animateRange(this.currentView.domNode,_2e&&ltr,true,_2e?-100:100,0,function(){_29.afterActivate();});this._animRangeInDir=null;this._animRangeOutDir=null;}),100);}));}else{_29.beforeActivate();this._applyViewChange(_29,_2a,_2b,_2c);_29.afterActivate();}}else{if(this.currentView){_2d.beforeDeactivate();}_29.beforeActivate();this._applyViewChange(_29,_2a,_2b,_2c);if(this.currentView){_2d.afterDeactivate();}_29.afterActivate();}},onViewConfigurationChange:function(_30){},_applyViewChange:function(_31,_32,_33,_34){this._configureView(_31,_32,_33,_34);this.onViewConfigurationChange(_31);if(_32!=this._currentViewIndex){if(this.currentView==null){_31.set("items",this.items);this.set("currentView",_31);}else{if(this.items==null||this.items.length==0){this.set("currentView",_31);if(this.animateRange&&(!_2("ie")||_2("ie")>8)){_9.set(this.currentView.domNode,"opacity",0);}_31.set("items",this.items);}else{this.currentView=_31;_31.set("items",this.items);this.set("currentView",_31);if(this.animateRange&&(!_2("ie")||_2("ie")>8)){_9.set(this.currentView.domNode,"opacity",0);}}}}},_timeInterval:null,computeTimeInterval:function(){var d=this.get("date");var _35=this.get("minDate");var _36=this.get("maxDate");var cal=this.dateModule;if(d==null){var _37=this.get("startDate");var _38=cal.add(this.get("endDate"),"day",1);if(_35!=null||_36!=null){var dur=this.dateModule.difference(_37,_38,"day");if(cal.compare(_35,_37)>0){_37=_35;_38=cal.add(_37,"day",dur);}if(cal.compare(_36,_38)<0){_38=_36;_37=cal.add(_38,"day",-dur);}if(cal.compare(_35,_37)>0){_37=_35;_38=_36;}}return [this.floorToDay(_37),this.floorToDay(_38)];}else{var _39=this._computeTimeIntervalImpl(d);if(_35!=null){var _3a=this._computeTimeIntervalImpl(_35);if(cal.compare(_3a[0],_39[0])>0){_39=_3a;}}if(_36!=null){var _3b=this._computeTimeIntervalImpl(_36);if(cal.compare(_3b[1],_39[1])<0){_39=_3b;}}return _39;}},_computeTimeIntervalImpl:function(d){var cal=this.dateModule;var s=this.floorToDay(d);var di=this.get("dateInterval");var dis=this.get("dateIntervalSteps");var e;switch(di){case "day":e=cal.add(s,"day",dis);break;case "week":s=this.floorToWeek(s);e=cal.add(s,"week",dis);break;case "month":s.setDate(1);e=cal.add(s,"month",dis);break;default:e=cal.add(s,"day",1);}return [s,e];},onTimeIntervalChange:function(e){},views:null,_setViewsAttr:function(_3c){if(!this._applyAttr){for(var i=0;i<this.views.length;i++){this._onViewRemoved(this.views[i]);}}if(_3c!=null){for(var i=0;i<_3c.length;i++){this._onViewAdded(_3c[i]);}}this._set("views",_3c==null?[]:_3c.concat());},_getViewsAttr:function(){return this.views.concat();},_createDefaultViews:function(){},addView:function(_3d,_3e){if(_3e<=0||_3e>this.views.length){_3e=this.views.length;}this.views.splice(_3e,_3d);this._onViewAdded(_3d);},removeView:function(_3f){if(index<0||index>=this.views.length){return;}this._onViewRemoved(this.views[index]);this.views.splice(index,1);},_onViewAdded:function(_40){_40.owner=this;_40.buttonContainer=this.buttonContainer;_40._calendar=this._calendar;_40.datePackage=this.datePackage;_40.dateModule=this.dateModule;_40.dateClassObj=this.dateClassObj;_40.dateLocaleModule=this.dateLocaleModule;_9.set(_40.domNode,"display","none");_8.add(_40.domNode,"view");_a.place(_40.domNode,this.viewContainer);this.onViewAdded(_40);},onViewAdded:function(_41){},_onViewRemoved:function(_42){_42.owner=null;_42.buttonContainer=null;_8.remove(_42.domNode,"view");this.viewContainer.removeChild(_42.domNode);this.onViewRemoved(_42);},onViewRemoved:function(_43){},_setCurrentViewAttr:function(_44){var _45=_5.indexOf(this.views,_44);if(_45!=-1){var _46=this.get("currentView");this._currentViewIndex=_45;this._set("currentView",_44);this._showView(_46,_44);this.onCurrentViewChange({oldView:_46,newView:_44});}},_getCurrentViewAttr:function(){return this.views[this._currentViewIndex];},onCurrentViewChange:function(e){},_configureView:function(_47,_48,_49,_4a){var cal=this.dateModule;if(_47.viewKind=="columns"){_47.set("startDate",_49[0]);_47.set("columnCount",_4a);}else{if(_47.viewKind=="matrix"){if(_4a>7){var s=this.floorToWeek(_49[0]);var e=this.floorToWeek(_49[1]);if(cal.compare(e,_49[1])!=0){e=this.dateModule.add(e,"week",1);}_4a=this.dateModule.difference(s,e,"day");_47.set("startDate",s);_47.set("columnCount",7);_47.set("rowCount",Math.ceil(_4a/7));_47.set("refStartTime",_49[0]);_47.set("refEndTime",_49[1]);}else{_47.set("startDate",_49[0]);_47.set("columnCount",_4a);_47.set("rowCount",1);_47.set("refStartTime",null);_47.set("refEndTime",null);}}}},_computeCurrentView:function(_4b,_4c,_4d){return _4d<=7?this.columnView:this.matrixView;},matrixViewRowHeaderClick:function(e){var _4e=this.matrixView.getExpandedRowIndex();if(_4e==e.index){this.matrixView.collapseRow();}else{if(_4e==-1){this.matrixView.expandRow(e.index);}else{var h=this.matrixView.on("expandAnimationEnd",_4.hitch(this,function(){h.remove();this.matrixView.expandRow(e.index);}));this.matrixView.collapseRow();}}},columnViewColumnHeaderClick:function(e){var cal=this.dateModule;if(cal.compare(e.date,this._timeInterval[0])==0&&this.dateInterval=="day"&&this.dateIntervalSteps==1){this.set("dateInterval","week");}else{this.set("date",e.date);this.set("dateInterval","day");this.set("dateIntervalSteps",1);}},viewChangeDuration:0,_showView:function(_4f,_50){if(_4f!=null){_9.set(_4f.domNode,"display","none");}if(_50!=null){_9.set(_50.domNode,"display","block");_50.resize();if(!_2("ie")||_2("ie")>7){_9.set(_50.domNode,"opacity","1");}}},_setItemsAttr:function(_51){this._set("items",_51);if(this.currentView){this.currentView.set("items",_51);if(!this._isEditing){this.currentView.invalidateRendering();}}},floorToDay:function(_52,_53){return _14.floorToDay(_52,_53,this.dateClassObj);},floorToWeek:function(d){return _14.floorToWeek(d,this.dateClassObj,this.dateModule,this.firstDayOfWeek,this.locale);},newDate:function(obj){return _14.newDate(obj,this.dateClassObj);},isToday:function(_54){return _14.isToday(_54,this.dateClassObj);},isStartOfDay:function(d){return _14.isStartOfDay(d,this.dateClassObj,this.dateModule);},floorDate:function(_55,_56,_57,_58){return _14.floor(_55,_56,_57,_58,this.classFuncObj);},animateRange:true,animationRangeDuration:400,_animateRange:function(_59,_5a,_5b,_5c,xTo,_5d){if(this.animateRangeTimer){clearTimeout(this.animateRangeTimer);delete this.animateRangeTimer;}var _5e=_5b?_d.fadeIn:_d.fadeOut;_9.set(_59,{left:_5c+"px",right:(-_5c)+"px"});fx.combine([_d.animateProperty({node:_59,properties:{left:xTo,right:-xTo},duration:this.animationRangeDuration/2,onEnd:_5d}),_5e({node:_59,duration:this.animationRangeDuration/2})]).play();},_animRangeOutDir:null,_animRangeOutDir:null,nextRange:function(){this._animRangeOutDir="left";this._animRangeInDir="right";this._navigate(1);},previousRange:function(){this._animRangeOutDir="right";this._animRangeInDir="left";this._navigate(-1);},_navigate:function(dir){var d=this.get("date");var cal=this.dateModule;if(d==null){var s=this.get("startDate");var e=this.get("endDate");var dur=cal.difference(s,e,"day");if(dir==1){e=cal.add(e,"day",1);this.set("startDate",e);this.set("endDate",cal.add(e,"day",dur));}else{s=cal.add(s,"day",-1);this.set("startDate",cal.add(s,"day",-dur));this.set("endDate",s);}}else{var di=this.get("dateInterval");var dis=this.get("dateIntervalSteps");this.set("date",cal.add(d,di,dir*dis));}},goToday:function(){this.set("date",this.floorToDay(new this.dateClassObj(),true));this.set("dateInterval","day");this.set("dateIntervalSteps",1);},postCreate:function(){this.inherited(arguments);this.configureButtons();},configureButtons:function(){var rtl=!this.isLeftToRight();if(this.previousButton){this.previousButton.set("label",_15[rtl?"nextButton":"previousButton"]);this.own(on(this.previousButton,"click",_4.hitch(this,this.previousRange)));}if(this.nextButton){this.nextButton.set("label",_15[rtl?"previousButton":"nextButton"]);this.own(on(this.nextButton,"click",_4.hitch(this,this.nextRange)));}if(rtl&&this.previousButton&&this.nextButton){var t=this.previousButton;this.previousButton=this.nextButton;this.nextButton=t;}if(this.todayButton){this.todayButton.set("label",_15.todayButton);this.own(on(this.todayButton,"click",_4.hitch(this,this.todayButtonClick)));}if(this.dayButton){this.dayButton.set("label",_15.dayButton);this.own(on(this.dayButton,"click",_4.hitch(this,this.dayButtonClick)));}if(this.weekButton){this.weekButton.set("label",_15.weekButton);this.own(on(this.weekButton,"click",_4.hitch(this,this.weekButtonClick)));}if(this.fourDaysButton){this.fourDaysButton.set("label",_15.fourDaysButton);this.own(on(this.fourDaysButton,"click",_4.hitch(this,this.fourDaysButtonClick)));}if(this.monthButton){this.monthButton.set("label",_15.monthButton);this.own(on(this.monthButton,"click",_4.hitch(this,this.monthButtonClick)));}},todayButtonClick:function(e){this.goToday();},dayButtonClick:function(e){if(this.get("date")==null){this.set("date",this.floorToDay(new this.dateClassObj(),true));}this.set("dateInterval","day");this.set("dateIntervalSteps",1);},weekButtonClick:function(e){this.set("dateInterval","week");this.set("dateIntervalSteps",1);},fourDaysButtonClick:function(e){this.set("dateInterval","day");this.set("dateIntervalSteps",4);},monthButtonClick:function(e){this.set("dateInterval","month");this.set("dateIntervalSteps",1);},updateRenderers:function(obj,_5f){if(this.currentView){this.currentView.updateRenderers(obj,_5f);}},getIdentity:function(_60){return _60?_60.id:null;},_setHoveredItem:function(_61,_62){if(this.hoveredItem&&_61&&this.hoveredItem.id!=_61.id||_61==null||this.hoveredItem==null){var old=this.hoveredItem;this.hoveredItem=_61;this.updateRenderers([old,this.hoveredItem],true);if(_61&&_62){this.currentView._updateEditingCapabilities(_61._item?_61._item:_61,_62);}}},hoveredItem:null,isItemHovered:function(_63){return this.hoveredItem!=null&&this.hoveredItem.id==_63.id;},isItemEditable:function(_64,_65){return this.editable;},isItemMoveEnabled:function(_66,_67){return this.isItemEditable(_66,_67)&&this.moveEnabled;},isItemResizeEnabled:function(_68,_69){return this.isItemEditable(_68,_69)&&this.resizeEnabled;},onGridClick:function(e){},onGridDoubleClick:function(e){},onItemClick:function(e){},onItemDoubleClick:function(e){},onItemContextMenu:function(e){},onItemEditBegin:function(e){},onItemEditEnd:function(e){},onItemEditBeginGesture:function(e){},onItemEditMoveGesture:function(e){},onItemEditResizeGesture:function(e){},onItemEditEndGesture:function(e){},onItemRollOver:function(e){},onItemRollOut:function(e){},onColumnHeaderClick:function(e){},onRowHeaderClick:function(e){},onExpandRendererClick:function(e){},_onRendererCreated:function(e){this.onRendererCreated(e);},onRendererCreated:function(e){},_onRendererRecycled:function(e){this.onRendererRecycled(e);},onRendererRecycled:function(e){},_onRendererReused:function(e){this.onRendererReused(e);},onRendererReused:function(e){},_onRendererDestroyed:function(e){this.onRendererDestroyed(e);},onRendererDestroyed:function(e){},_onRenderersLayoutDone:function(_6a){this.onRenderersLayoutDone(_6a);},onRenderersLayoutDone:function(_6b){}});});