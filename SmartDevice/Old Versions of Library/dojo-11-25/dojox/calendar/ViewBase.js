//>>built
define("dojox/calendar/ViewBase",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/event","dojo/_base/html","dojo/sniff","dojo/query","dojo/dom","dojo/dom-style","dojo/dom-construct","dojo/dom-geometry","dojo/on","dojo/date","dojo/date/locale","dojo/when","dijit/_WidgetBase","dojox/widget/_Invalidating","dojox/widget/Selection","dojox/calendar/time","./StoreMixin"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,on,_d,_e,_f,_10,_11,_12,_13,_14){return _1("dojox.calendar.ViewBase",[_10,_14,_11,_12],{datePackage:_d,_calendar:"gregorian",viewKind:null,_layoutStep:1,_layoutUnit:"day",resizeCursor:"n-resize",formatItemTimeFunc:null,_cssDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],_getFormatItemTimeFuncAttr:function(){if(this.owner!=null){return this.owner.get("formatItemTimeFunc");}return this.formatItemTimeFunc;},_viewHandles:null,doubleTapDelay:300,constructor:function(_15){_15=_15||{};this._calendar=_15.datePackage?_15.datePackage.substr(_15.datePackage.lastIndexOf(".")+1):this._calendar;this.dateModule=_15.datePackage?_2.getObject(_15.datePackage,false):_d;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=_15.datePackage?_2.getObject(_15.datePackage+".locale",false):_e;this.rendererPool=[];this.rendererList=[];this.itemToRenderer={};this._viewHandles=[];},destroy:function(_16){while(this.rendererList.length>0){this._destroyRenderer(this.rendererList.pop());}for(var _17 in this._rendererPool){var _18=this._rendererPool[_17];if(_18){while(_18.length>0){this._destroyRenderer(_18.pop());}}}while(this._viewHandles.length>0){this._viewHandles.pop().remove();}this.inherited(arguments);},resize:function(){},beforeActivate:function(){},afterActivate:function(){},beforeDeactivate:function(){},afterDeactivate:function(){},_getTopOwner:function(){var p=this;while(p.owner!=undefined){p=p.owner;}return p;},_createRenderData:function(){},_validateProperties:function(){},_setText:function(_19,_1a,_1b){if(_1a!=null){if(!_1b&&_19.hasChildNodes()){_19.childNodes[0].childNodes[0].nodeValue=_1a;}else{while(_19.hasChildNodes()){_19.removeChild(_19.lastChild);}var _1c=_4.doc.createElement("span");if(_7("dojo-bidi")){this.applyTextDir(_1c,_1a);}if(_1b){_1c.innerHTML=_1a;}else{_1c.appendChild(_4.doc.createTextNode(_1a));}_19.appendChild(_1c);}}},isAscendantHasClass:function(_1d,_1e,_1f){while(_1d!=_1e&&_1d!=document){if(dojo.hasClass(_1d,_1f)){return true;}_1d=_1d.parentNode;}return false;},isWeekEnd:function(_20){return _e.isWeekend(_20);},getWeekNumberLabel:function(_21){if(_21.toGregorian){_21=_21.toGregorian();}return _e.format(_21,{selector:"date",datePattern:"w"});},floorToDay:function(_22,_23){return _13.floorToDay(_22,_23,this.dateClassObj);},floorToMonth:function(_24,_25){return _13.floorToMonth(_24,_25,this.dateClassObj);},floorDate:function(_26,_27,_28,_29){return _13.floor(_26,_27,_28,_29,this.dateClassObj);},isToday:function(_2a){return _13.isToday(_2a,this.dateClassObj);},isStartOfDay:function(d){return _13.isStartOfDay(d,this.dateClassObj,this.dateModule);},isOverlapping:function(_2b,_2c,_2d,_2e,_2f,_30){if(_2c==null||_2e==null||_2d==null||_2f==null){return false;}var cal=_2b.dateModule;if(_30){if(cal.compare(_2c,_2f)==1||cal.compare(_2e,_2d)==1){return false;}}else{if(cal.compare(_2c,_2f)!=-1||cal.compare(_2e,_2d)!=-1){return false;}}return true;},computeRangeOverlap:function(_31,_32,_33,_34,_35,_36){var cal=_31.dateModule;if(_32==null||_34==null||_33==null||_35==null){return null;}var _37=cal.compare(_32,_35);var _38=cal.compare(_34,_33);if(_36){if(_37==0||_37==1||_38==0||_38==1){return null;}}else{if(_37==1||_38==1){return null;}}return [this.newDate(cal.compare(_32,_34)>0?_32:_34,_31),this.newDate(cal.compare(_33,_35)>0?_35:_33,_31)];},isSameDay:function(_39,_3a){if(_39==null||_3a==null){return false;}return _39.getFullYear()==_3a.getFullYear()&&_39.getMonth()==_3a.getMonth()&&_39.getDate()==_3a.getDate();},computeProjectionOnDate:function(_3b,_3c,_3d,max){var cal=_3b.dateModule;var _3e=_3b.minHours;var _3f=_3b.maxHours;if(max<=0||cal.compare(_3d,_3c)==-1){return 0;}var gt=function(d){return d.getHours()*3600+d.getMinutes()*60+d.getSeconds();};var _40=this.floorToDay(_3c,false,_3b);if(_3d.getDate()!=_40.getDate()){if(_3d.getMonth()==_40.getMonth()){if(_3d.getDate()<_40.getDate()){return 0;}else{if(_3d.getDate()>_40.getDate()&&_3f<24){return max;}}}else{if(_3d.getFullYear()==_40.getFullYear()){if(_3d.getMonth()<_40.getMonth()){return 0;}else{if(_3d.getMonth()>_40.getMonth()){return max;}}}else{if(_3d.getFullYear()<_40.getFullYear()){return 0;}else{if(_3d.getFullYear()>_40.getFullYear()){return max;}}}}}var res;var _41=86400;if(this.isSameDay(_3c,_3d)||_3f>24){var d=_2.clone(_3c);var _42=0;if(_3e!=null&&_3e!=0){d.setHours(_3e);_42=gt(d);}d=_2.clone(_3c);d.setHours(_3f);var _43;if(_3f==null||_3f==24){_43=_41;}else{if(_3f>24){_43=_41+gt(d);}else{_43=gt(d);}}var _44=0;if(_3f>24&&_3c.getDate()!=_3d.getDate()){_44=_41+gt(_3d);}else{_44=gt(_3d);}if(_44<_42){return 0;}if(_44>_43){return max;}_44-=_42;res=(max*_44)/(_43-_42);}else{if(_3d.getDate()<_3c.getDate()&&_3d.getMonth()==_3c.getMonth()){return 0;}var d2=this.floorToDay(_3d);var dp1=_3b.dateModule.add(_3c,"day",1);dp1=this.floorToDay(dp1,false,_3b);if(cal.compare(d2,_3c)==1&&cal.compare(d2,dp1)==0||cal.compare(d2,dp1)==1){res=max;}else{res=0;}}return res;},getTime:function(e,x,y,_45){return null;},getSubColumn:function(e,x,y,_46){return null;},getSubColumnIndex:function(_47){if(this.subColumns){for(var i=0;i<this.subColumns.length;i++){if(this.subColumns[i]==_47){return i;}}}return -1;},newDate:function(obj){return _13.newDate(obj,this.dateClassObj);},_isItemInView:function(_48){var rd=this.renderData;var cal=rd.dateModule;if(cal.compare(_48.startTime,rd.startTime)==-1){return false;}return cal.compare(_48.endTime,rd.endTime)!=1;},_ensureItemInView:function(_49){var rd=this.renderData;var cal=rd.dateModule;var _4a=Math.abs(cal.difference(_49.startTime,_49.endTime,"millisecond"));var _4b=false;if(cal.compare(_49.startTime,rd.startTime)==-1){_49.startTime=rd.startTime;_49.endTime=cal.add(_49.startTime,"millisecond",_4a);_4b=true;}else{if(cal.compare(_49.endTime,rd.endTime)==1){_49.endTime=rd.endTime;_49.startTime=cal.add(_49.endTime,"millisecond",-_4a);_4b=true;}}return _4b;},scrollable:true,autoScroll:true,_autoScroll:function(gx,gy,_4c){return false;},scrollMethod:"auto",_setScrollMethodAttr:function(_4d){if(this.scrollMethod!=_4d){this.scrollMethod=_4d;if(this._domScroll!==undefined){if(this._domScroll){_a.set(this.sheetContainer,this._cssPrefix+"transform","translateY(0px)");}else{this.scrollContainer.scrollTop=0;}}delete this._domScroll;var pos=this._getScrollPosition();delete this._scrollPos;this._setScrollPosition(pos);}},_startAutoScroll:function(_4e){var sp=this._scrollProps;if(!sp){sp=this._scrollProps={};}sp.scrollStep=_4e;if(!sp.isScrolling){sp.isScrolling=true;sp.scrollTimer=setInterval(_2.hitch(this,this._onScrollTimer_tick),10);}},_stopAutoScroll:function(){var sp=this._scrollProps;if(sp&&sp.isScrolling){clearInterval(sp.scrollTimer);sp.scrollTimer=null;}this._scrollProps=null;},_onScrollTimer_tick:function(pos){},_scrollPos:0,getCSSPrefix:function(){if(_7("ie")){return "-ms-";}if(_7("webkit")){return "-webkit-";}if(_7("mozilla")){return "-moz-";}if(_7("opera")){return "-o-";}return "";},_setScrollPosition:function(pos){if(this._scrollPos==pos){return;}if(this._domScroll===undefined){var sm=this.get("scrollMethod");if(sm==="auto"){this._domScroll=!_7("ios")&&!_7("android")&&!_7("webkit");}else{this._domScroll=sm==="dom";}}var _4f=_c.getMarginBox(this.scrollContainer);var _50=_c.getMarginBox(this.sheetContainer);var max=_50.h-_4f.h;if(pos<0){pos=0;}else{if(pos>max){pos=max;}}this._scrollPos=pos;if(this._domScroll){this.scrollContainer.scrollTop=pos;}else{if(!this._cssPrefix){this._cssPrefix=this.getCSSPrefix();}_a.set(this.sheetContainer,this._cssPrefix+"transform","translateY(-"+pos+"px)");}},_getScrollPosition:function(){return this._scrollPos;},scrollView:function(dir){},ensureVisibility:function(_51,end,_52,_53,_54){},_getStoreAttr:function(){if(this.owner){return this.owner.get("store");}return this.store;},_setItemsAttr:function(_55){this._set("items",_55);this.displayedItemsInvalidated=true;},_refreshItemsRendering:function(){var rd=this.renderData;this._computeVisibleItems(rd);this._layoutRenderers(rd);},invalidateLayout:function(){this._layoutRenderers(this.renderData);},resize:function(){},computeOverlapping:function(_56,_57){if(_56.length==0){return {numLanes:0,addedPassRes:[1]};}var _58=[];for(var i=0;i<_56.length;i++){var _59=_56[i];this._layoutPass1(_59,_58);}var _5a=null;if(_57){_5a=_2.hitch(this,_57)(_58);}return {numLanes:_58.length,addedPassRes:_5a};},_layoutPass1:function(_5b,_5c){var _5d=true;for(var i=0;i<_5c.length;i++){var _5e=_5c[i];_5d=false;for(var j=0;j<_5e.length&&!_5d;j++){if(_5e[j].start<_5b.end&&_5b.start<_5e[j].end){_5d=true;_5e[j].extent=1;}}if(!_5d){_5b.lane=i;_5b.extent=-1;_5e.push(_5b);return;}}_5c.push([_5b]);_5b.lane=_5c.length-1;_5b.extent=-1;},_layoutInterval:function(_5f,_60,_61,end,_62){},layoutPriorityFunction:null,_sortItemsFunction:function(a,b){var res=this.dateModule.compare(a.startTime,b.startTime);if(res==0){res=-1*this.dateModule.compare(a.endTime,b.endTime);}return res;},_layoutRenderers:function(_63){if(!_63.items){return;}this._recycleItemRenderers();var cal=_63.dateModule;var _64=this.newDate(_63.startTime);var _65=_2.clone(_64);var _66;var _67=_63.items.concat();var _68=[],_69;var _6a={};var _6b=0;while(cal.compare(_64,_63.endTime)==-1&&_67.length>0){_66=cal.add(_64,this._layoutUnit,this._layoutStep);_66=this.floorToDay(_66,true,_63);var _6c=_2.clone(_66);if(_63.minHours){_65.setHours(_63.minHours);}if(_63.maxHours!=undefined&&_63.maxHours!=24){if(_63.maxHours<24){_6c=cal.add(_66,"day",-1);}_6c=this.floorToDay(_6c,true,_63);_6c.setHours(_63.maxHours-(_63.maxHours<24?0:24));}_69=_3.filter(_67,function(_6d){var r=this.isOverlapping(_63,_6d.startTime,_6d.endTime,_65,_6c);if(r){_6a[_6d.id]=true;_68.push(_6d);}else{if(_6a[_6d.id]){delete _6a[_6d.id];}else{_68.push(_6d);}}return r;},this);_67=_68;_68=[];if(_69.length>0){_69.sort(_2.hitch(this,this.layoutPriorityFunction?this.layoutPriorityFunction:this._sortItemsFunction));this._layoutInterval(_63,_6b,_65,_6c,_69);}_64=_66;_65=_2.clone(_64);_6b++;}this._onRenderersLayoutDone(this);},_recycleItemRenderers:function(_6e){while(this.rendererList.length>0){this._recycleRenderer(this.rendererList.pop(),_6e);}this.itemToRenderer={};},rendererPool:null,rendererList:null,itemToRenderer:null,getRenderers:function(_6f){if(_6f==null||_6f.id==null){return null;}var _70=this.itemToRenderer[_6f.id];return _70==null?null:_70.concat();},_rendererHandles:{},itemToRendererKindFunc:null,_itemToRendererKind:function(_71){if(this.itemToRendererKindFunc){return this.itemToRendererKindFunc(_71);}return this._defaultItemToRendererKindFunc(_71);},_defaultItemToRendererKindFunc:function(_72){return null;},_createRenderer:function(_73,_74,_75,_76){if(_73!=null&&_74!=null&&_75!=null){var res=null,_77=null;var _78=this.rendererPool[_74];if(_78!=null){res=_78.shift();}if(res==null){_77=new _75;res={renderer:_77,container:_77.domNode,kind:_74};this._onRendererCreated({renderer:res,source:this,item:_73});}else{_77=res.renderer;this._onRendererReused({renderer:_77,source:this,item:_73});}_77.owner=this;_77.set("rendererKind",_74);_77.set("item",_73);var _79=this.itemToRenderer[_73.id];if(_79==null){this.itemToRenderer[_73.id]=_79=[];}_79.push(res);this.rendererList.push(res);return res;}return null;},_onRendererCreated:function(e){if(e.source==this){this.onRendererCreated(e);}if(this.owner!=null){this.owner._onRendererCreated(e);}},onRendererCreated:function(e){},_onRendererRecycled:function(e){if(e.source==this){this.onRendererRecycled(e);}if(this.owner!=null){this.owner._onRendererRecycled(e);}},onRendererRecycled:function(e){},_onRendererReused:function(e){if(e.source==this){this.onRendererReused(e);}if(this.owner!=null){this.owner._onRendererReused(e);}},onRendererReused:function(e){},_onRendererDestroyed:function(e){if(e.source==this){this.onRendererDestroyed(e);}if(this.owner!=null){this.owner._onRendererDestroyed(e);}},onRendererDestroyed:function(e){},_onRenderersLayoutDone:function(_7a){this.onRenderersLayoutDone(_7a);if(this.owner!=null){this.owner._onRenderersLayoutDone(_7a);}},onRenderersLayoutDone:function(_7b){},_recycleRenderer:function(_7c,_7d){this._onRendererRecycled({renderer:_7c,source:this});var _7e=this.rendererPool[_7c.kind];if(_7e==null){this.rendererPool[_7c.kind]=[_7c];}else{_7e.push(_7c);}if(_7d){_7c.container.parentNode.removeChild(_7c.container);}_a.set(_7c.container,"display","none");_7c.renderer.owner=null;_7c.renderer.set("item",null);},_destroyRenderer:function(_7f){this._onRendererDestroyed({renderer:_7f,source:this});var ir=_7f.renderer;if(ir["destroy"]){ir.destroy();}_6.destroy(_7f.container);},_destroyRenderersByKind:function(_80){var _81=[];for(var i=0;i<this.rendererList.length;i++){var ir=this.rendererList[i];if(ir.kind==_80){this._destroyRenderer(ir);}else{_81.push(ir);}}this.rendererList=_81;var _82=this.rendererPool[_80];if(_82){while(_82.length>0){this._destroyRenderer(_82.pop());}}},_updateEditingCapabilities:function(_83,_84){var _85=this.isItemMoveEnabled(_83,_84.rendererKind);var _86=this.isItemResizeEnabled(_83,_84.rendererKind);var _87=false;if(_85!=_84.get("moveEnabled")){_84.set("moveEnabled",_85);_87=true;}if(_86!=_84.get("resizeEnabled")){_84.set("resizeEnabled",_86);_87=true;}if(_87){_84.updateRendering();}},updateRenderers:function(obj,_88){if(obj==null){return;}var _89=_2.isArray(obj)?obj:[obj];for(var i=0;i<_89.length;i++){var _8a=_89[i];if(_8a==null||_8a.id==null){continue;}var _8b=this.itemToRenderer[_8a.id];if(_8b==null){continue;}var _8c=this.isItemSelected(_8a);var _8d=this.isItemHovered(_8a);var _8e=this.isItemBeingEdited(_8a);var _8f=this.showFocus?this.isItemFocused(_8a):false;for(var j=0;j<_8b.length;j++){var _90=_8b[j].renderer;_90.set("hovered",_8d);_90.set("selected",_8c);_90.set("edited",_8e);_90.set("focused",_8f);_90.set("storeState",this.getItemStoreState(_8a));this.applyRendererZIndex(_8a,_8b[j],_8d,_8c,_8e,_8f);if(!_88){_90.set("item",_8a);if(_90.updateRendering){_90.updateRendering();}}}}},applyRendererZIndex:function(_91,_92,_93,_94,_95,_96){_a.set(_92.container,{"zIndex":_95||_94?20:_91.lane==undefined?0:_91.lane});},getIdentity:function(_97){return this.owner?this.owner.getIdentity(_97):_97.id;},_setHoveredItem:function(_98,_99){if(this.owner){this.owner._setHoveredItem(_98,_99);return;}if(this.hoveredItem&&_98&&this.hoveredItem.id!=_98.id||_98==null||this.hoveredItem==null){var old=this.hoveredItem;this.hoveredItem=_98;this.updateRenderers([old,this.hoveredItem],true);if(_98&&_99){this._updateEditingCapabilities(_98._item?_98._item:_98,_99);}}},hoveredItem:null,isItemHovered:function(_9a){if(this._isEditing&&this._edProps){return _9a.id==this._edProps.editedItem.id;}return this.owner?this.owner.isItemHovered(_9a):this.hoveredItem!=null&&this.hoveredItem.id==_9a.id;},isItemFocused:function(_9b){return this._isItemFocused?this._isItemFocused(_9b):false;},_setSelectionModeAttr:function(_9c){if(this.owner){this.owner.set("selectionMode",_9c);}else{this.inherited(arguments);}},_getSelectionModeAttr:function(_9d){if(this.owner){return this.owner.get("selectionMode");}return this.inherited(arguments);},_setSelectedItemAttr:function(_9e){if(this.owner){this.owner.set("selectedItem",_9e);}else{this.inherited(arguments);}},_getSelectedItemAttr:function(_9f){if(this.owner){return this.owner.get("selectedItem");}return this.selectedItem;},_setSelectedItemsAttr:function(_a0){if(this.owner){this.owner.set("selectedItems",_a0);}else{this.inherited(arguments);}},_getSelectedItemsAttr:function(){if(this.owner){return this.owner.get("selectedItems");}return this.inherited(arguments);},isItemSelected:function(_a1){if(this.owner){return this.owner.isItemSelected(_a1);}return this.inherited(arguments);},selectFromEvent:function(e,_a2,_a3,_a4){if(this.owner){this.owner.selectFromEvent(e,_a2,_a3,_a4);}else{this.inherited(arguments);}},setItemSelected:function(_a5,_a6){if(this.owner){this.owner.setItemSelected(_a5,_a6);}else{this.inherited(arguments);}},createItemFunc:null,_getCreateItemFuncAttr:function(){if(this.owner){return this.owner.get("createItemFunc");}return this.createItemFunc;},createOnGridClick:false,_getCreateOnGridClickAttr:function(){if(this.owner){return this.owner.get("createOnGridClick");}return this.createOnGridClick;},_gridMouseDown:false,_tempIdCount:0,_tempItemsMap:null,_onGridMouseDown:function(e){this._gridMouseDown=true;this.showFocus=false;if(this._isEditing){this._endItemEditing("mouse",false);}this._doEndItemEditing(this.owner,"mouse");this.set("focusedItem",null);this.selectFromEvent(e,null,null,true);if(this._setTabIndexAttr){this[this._setTabIndexAttr].focus();}if(this._onRendererHandleMouseDown){var f=this.get("createItemFunc");if(!f){return;}var _a7=this._createdEvent=f(this,this.getTime(e),e,this.getSubColumn(e));var _a8=this.get("store");if(!_a7||_a8==null){return;}if(_a8.getIdentity(_a7)==undefined){var id="_tempId_"+(this._tempIdCount++);_a7[_a8.idProperty]=id;if(this._tempItemsMap==null){this._tempItemsMap={};}this._tempItemsMap[id]=true;}var _a9=this.itemToRenderItem(_a7,_a8);_a9._item=_a7;this._setItemStoreState(_a7,"unstored");var _aa=this._getTopOwner();var _ab=_aa.get("items");_aa.set("items",_ab?_ab.concat([_a9]):[_a9]);this._refreshItemsRendering();var _ac=this.getRenderers(_a7);if(_ac&&_ac.length>0){var _ad=_ac[0];if(_ad){this._onRendererHandleMouseDown(e,_ad.renderer,"resizeEnd");}}}},_onGridMouseMove:function(e){},_onGridMouseUp:function(e){},_onGridTouchStart:function(e){var p=this._edProps;this._gridProps={event:e,fromItem:this.isAscendantHasClass(e.target,this.eventContainer,"dojoxCalendarEvent")};if(this._isEditing){if(this._gridProps){this._gridProps.editingOnStart=true;}_2.mixin(p,this._getTouchesOnRenderers(e,p.editedItem));if(p.touchesLen==0){if(p&&p.endEditingTimer){clearTimeout(p.endEditingTimer);p.endEditingTimer=null;}this._endItemEditing("touch",false);}}this._doEndItemEditing(this.owner,"touch");_5.stop(e);},_doEndItemEditing:function(obj,_ae){if(obj&&obj._isEditing){var p=obj._edProps;if(p&&p.endEditingTimer){clearTimeout(p.endEditingTimer);p.endEditingTimer=null;}obj._endItemEditing(_ae,false);}},_onGridTouchEnd:function(e){},_onGridTouchMove:function(e){},__fixEvt:function(e){return e;},_dispatchCalendarEvt:function(e,_af){e=this.__fixEvt(e);this[_af](e);if(this.owner){this.owner[_af](e);}return e;},_onGridClick:function(e){if(!e.triggerEvent){e={date:this.getTime(e),triggerEvent:e};}this._dispatchCalendarEvt(e,"onGridClick");},onGridClick:function(e){},_onGridDoubleClick:function(e){if(!e.triggerEvent){e={date:this.getTime(e),triggerEvent:e};}this._dispatchCalendarEvt(e,"onGridDoubleClick");},onGridDoubleClick:function(e){},_onItemClick:function(e){this._dispatchCalendarEvt(e,"onItemClick");},onItemClick:function(e){},_onItemDoubleClick:function(e){this._dispatchCalendarEvt(e,"onItemDoubleClick");},onItemDoubleClick:function(e){},_onItemContextMenu:function(e){this._dispatchCalendarEvt(e,"onItemContextMenu");},onItemContextMenu:function(e){},_getStartEndRenderers:function(_b0){var _b1=this.itemToRenderer[_b0.id];if(_b1==null){return null;}if(_b1.length==1){var _b2=_b1[0].renderer;return [_b2,_b2];}var rd=this.renderData;var _b3=false;var _b4=false;var res=[];for(var i=0;i<_b1.length;i++){var ir=_b1[i].renderer;if(!_b3){_b3=rd.dateModule.compare(ir.item.range[0],ir.item.startTime)==0;res[0]=ir;}if(!_b4){_b4=rd.dateModule.compare(ir.item.range[1],ir.item.endTime)==0;res[1]=ir;}if(_b3&&_b4){break;}}return res;},editable:true,moveEnabled:true,resizeEnabled:true,isItemEditable:function(_b5,_b6){return this.getItemStoreState(_b5)!="storing"&&this.editable&&(this.owner?this.owner.isItemEditable(_b5,_b6):true);},isItemMoveEnabled:function(_b7,_b8){return this.isItemEditable(_b7,_b8)&&this.moveEnabled&&(this.owner?this.owner.isItemMoveEnabled(_b7,_b8):true);},isItemResizeEnabled:function(_b9,_ba){return this.isItemEditable(_b9,_ba)&&this.resizeEnabled&&(this.owner?this.owner.isItemResizeEnabled(_b9,_ba):true);},_isEditing:false,isItemBeingEdited:function(_bb){return this._isEditing&&this._edProps&&this._edProps.editedItem&&this._edProps.editedItem.id==_bb.id;},_setEditingProperties:function(_bc){this._edProps=_bc;},_startItemEditing:function(_bd,_be){this._isEditing=true;this._getTopOwner()._isEditing=true;var p=this._edProps;p.editedItem=_bd;p.storeItem=_bd._item;p.eventSource=_be;p.secItem=this._secondarySheet?this._findRenderItem(_bd.id,this._secondarySheet.renderData.items):null;p.ownerItem=this.owner?this._findRenderItem(_bd.id,this.items):null;if(!p.liveLayout){p.editSaveStartTime=_bd.startTime;p.editSaveEndTime=_bd.endTime;p.editItemToRenderer=this.itemToRenderer;p.editItems=this.renderData.items;p.editRendererList=this.rendererList;this.renderData.items=[p.editedItem];var id=p.editedItem.id;this.itemToRenderer={};this.rendererList=[];var _bf=p.editItemToRenderer[id];p.editRendererIndices=[];_3.forEach(_bf,_2.hitch(this,function(ir,i){if(this.itemToRenderer[id]==null){this.itemToRenderer[id]=[ir];}else{this.itemToRenderer[id].push(ir);}this.rendererList.push(ir);}));p.editRendererList=_3.filter(p.editRendererList,function(ir){return ir!=null&&ir.renderer.item.id!=id;});delete p.editItemToRenderer[id];}this._layoutRenderers(this.renderData);this._onItemEditBegin({item:_bd,storeItem:p.storeItem,eventSource:_be});},_onItemEditBegin:function(e){this._editStartTimeSave=this.newDate(e.item.startTime);this._editEndTimeSave=this.newDate(e.item.endTime);this._dispatchCalendarEvt(e,"onItemEditBegin");},onItemEditBegin:function(e){},_endItemEditing:function(_c0,_c1){this._isEditing=false;this._getTopOwner()._isEditing=false;var p=this._edProps;_3.forEach(p.handles,function(_c2){_c2.remove();});if(!p.liveLayout){this.renderData.items=p.editItems;this.rendererList=p.editRendererList.concat(this.rendererList);_2.mixin(this.itemToRenderer,p.editItemToRenderer);}this._onItemEditEnd(_2.mixin(this._createItemEditEvent(),{item:p.editedItem,storeItem:p.storeItem,eventSource:_c0,completed:!_c1}));this._layoutRenderers(this.renderData);this._edProps=null;},_onItemEditEnd:function(e){this._dispatchCalendarEvt(e,"onItemEditEnd");if(!e.isDefaultPrevented()){var _c3=this.get("store");var _c4=this.renderItemToItem(e.item,_c3);var s=this._getItemStoreStateObj(e.item);if(s!=null&&s.state=="unstored"){if(e.completed){_c4=_2.mixin(s.item,_c4);this._setItemStoreState(_c4,"storing");var _c5=_c3.getIdentity(_c4);var _c6=null;if(this._tempItemsMap&&this._tempItemsMap[_c5]){_c6={temporaryId:_c5};delete this._tempItemsMap[_c5];delete _c4[_c3.idProperty];}_f(_c3.add(_c4,_c6),_2.hitch(this,function(res){var id;if(_2.isObject(res)){id=_c3.getIdentity(res);}else{id=res;}if(id!=_c5){this._removeRenderItem(_c5);}}));}else{this.removeRenderItem(s.id);}}else{if(e.completed){this._setItemStoreState(_c4,"storing");_c3.put(_c4);}else{e.item.startTime=this._editStartTimeSave;e.item.endTime=this._editEndTimeSave;}}}},_removeRenderItem:function(id){var _c7=this._getTopOwner();var _c8=_c7.get("items");var l=_c8.length;var _c9=false;for(var i=l-1;i>=0;i--){if(_c8[i].id==id){_c8.splice(i,1);_c9=true;break;}}this._cleanItemStoreState(id);if(_c9){_c7.set("items",_c8);this.invalidateLayout();}},onItemEditEnd:function(e){},_createItemEditEvent:function(){var e={cancelable:true,bubbles:false,__defaultPrevent:false};e.preventDefault=function(){this.__defaultPrevented=true;};e.isDefaultPrevented=function(){return this.__defaultPrevented;};return e;},_startItemEditingGesture:function(_ca,_cb,_cc,e){var p=this._edProps;if(!p||p.editedItem==null){return;}this._editingGesture=true;var _cd=p.editedItem;p.editKind=_cb;this._onItemEditBeginGesture(this.__fixEvt(_2.mixin(this._createItemEditEvent(),{item:_cd,storeItem:p.storeItem,startTime:_cd.startTime,endTime:_cd.endTime,editKind:_cb,rendererKind:p.rendererKind,triggerEvent:e,dates:_ca,eventSource:_cc})));p.itemBeginDispatched=true;},_onItemEditBeginGesture:function(e){var p=this._edProps;var _ce=p.editedItem;var _cf=e.dates;p.editingTimeFrom=[];p.editingTimeFrom[0]=_cf[0];p.editingItemRefTime=[];p.editingItemRefTime[0]=this.newDate(p.editKind=="resizeEnd"?_ce.endTime:_ce.startTime);if(p.editKind=="resizeBoth"){p.editingTimeFrom[1]=_cf[1];p.editingItemRefTime[1]=this.newDate(_ce.endTime);}var cal=this.renderData.dateModule;p.inViewOnce=this._isItemInView(_ce);if(p.rendererKind=="label"||this.roundToDay){p._itemEditBeginSave=this.newDate(_ce.startTime);p._itemEditEndSave=this.newDate(_ce.endTime);}p._initDuration=cal.difference(_ce.startTime,_ce.endTime,_ce.allDay?"day":"millisecond");this._dispatchCalendarEvt(e,"onItemEditBeginGesture");if(!e.isDefaultPrevented()){if(e.eventSource=="mouse"){var _d0=e.editKind=="move"?"move":this.resizeCursor;p.editLayer=_b.create("div",{style:"position: absolute; left:0; right:0; bottom:0; top:0; z-index:30; tabIndex:-1; background-image:url('"+this._blankGif+"'); cursor: "+_d0,onresizestart:function(e){return false;},onselectstart:function(e){return false;}},this.domNode);p.editLayer.focus();}}},onItemEditBeginGesture:function(e){},_waDojoxAddIssue:function(d,_d1,_d2){var cal=this.renderData.dateModule;if(this._calendar!="gregorian"&&_d2<0){var gd=d.toGregorian();gd=_d.add(gd,_d1,_d2);return new this.renderData.dateClassObj(gd);}else{return cal.add(d,_d1,_d2);}},_computeItemEditingTimes:function(_d3,_d4,_d5,_d6,_d7){var cal=this.renderData.dateModule;var p=this._edProps;var _d8=cal.difference(p.editingTimeFrom[0],_d6[0],"millisecond");_d6[0]=this._waDojoxAddIssue(p.editingItemRefTime[0],"millisecond",_d8);if(_d4=="resizeBoth"){_d8=cal.difference(p.editingTimeFrom[1],_d6[1],"millisecond");_d6[1]=this._waDojoxAddIssue(p.editingItemRefTime[1],"millisecond",_d8);}return _d6;},_moveOrResizeItemGesture:function(_d9,_da,e,_db){if(!this._isEditing||_d9[0]==null){return;}var p=this._edProps;var _dc=p.editedItem;var rd=this.renderData;var cal=rd.dateModule;var _dd=p.editKind;var _de=[_d9[0]];if(_dd=="resizeBoth"){_de[1]=_d9[1];}_de=this._computeItemEditingTimes(_dc,p.editKind,p.rendererKind,_de,_da);var _df=_de[0];var _e0=false;var _e1=_2.clone(_dc.startTime);var _e2=_2.clone(_dc.endTime);var _e3=_dc.subColumn;var _e4=p.eventSource=="keyboard"?false:this.allowStartEndSwap;if(_dd=="move"){if(_db!=null&&_dc.subColumn!=_db&&this.allowSubColumnMove){_dc.subColumn=_db;var _e5=this.get("store");var _e6=this.renderItemToItem(_dc,_e5);_2.mixin(_dc,this.itemToRenderItem(_e6,_e5));_e0=true;}if(cal.compare(_dc.startTime,_df)!=0){var _e7=cal.difference(_dc.startTime,_dc.endTime,"millisecond");_dc.startTime=this.newDate(_df);_dc.endTime=cal.add(_dc.startTime,"millisecond",_e7);_e0=true;}}else{if(_dd=="resizeStart"){if(cal.compare(_dc.startTime,_df)!=0){if(cal.compare(_dc.endTime,_df)!=-1){_dc.startTime=this.newDate(_df);}else{if(_e4){_dc.startTime=this.newDate(_dc.endTime);_dc.endTime=this.newDate(_df);p.editKind=_dd="resizeEnd";if(_da=="touch"){p.resizeEndTouchIndex=p.resizeStartTouchIndex;p.resizeStartTouchIndex=-1;}}else{_dc.startTime=this.newDate(_dc.endTime);_dc.startTime.setHours(_df.getHours());_dc.startTime.setMinutes(_df.getMinutes());_dc.startTime.setSeconds(_df.getSeconds());}}_e0=true;}}else{if(_dd=="resizeEnd"){if(cal.compare(_dc.endTime,_df)!=0){if(cal.compare(_dc.startTime,_df)!=1){_dc.endTime=this.newDate(_df);}else{if(_e4){_dc.endTime=this.newDate(_dc.startTime);_dc.startTime=this.newDate(_df);p.editKind=_dd="resizeStart";if(_da=="touch"){p.resizeStartTouchIndex=p.resizeEndTouchIndex;p.resizeEndTouchIndex=-1;}}else{_dc.endTime=this.newDate(_dc.startTime);_dc.endTime.setHours(_df.getHours());_dc.endTime.setMinutes(_df.getMinutes());_dc.endTime.setSeconds(_df.getSeconds());}}_e0=true;}}else{if(_dd=="resizeBoth"){_e0=true;var _e8=this.newDate(_df);var end=this.newDate(_de[1]);if(cal.compare(_e8,end)!=-1){if(_e4){var t=_e8;_e8=end;end=t;}else{_e0=false;}}if(_e0){_dc.startTime=_e8;_dc.endTime=end;}}else{return false;}}}}if(!_e0){return false;}var evt=_2.mixin(this._createItemEditEvent(),{item:_dc,storeItem:p.storeItem,startTime:_dc.startTime,endTime:_dc.endTime,editKind:_dd,rendererKind:p.rendererKind,triggerEvent:e,eventSource:_da});if(_dd=="move"){this._onItemEditMoveGesture(evt);}else{this._onItemEditResizeGesture(evt);}if(cal.compare(_dc.startTime,_dc.endTime)==1){var tmp=_dc.startTime;_dc.startTime=_dc.endTime;_dc.endTime=tmp;}_e0=_e3!=_dc.subColumn||cal.compare(_e1,_dc.startTime)!=0||cal.compare(_e2,_dc.endTime)!=0;if(!_e0){return false;}this._layoutRenderers(this.renderData);if(p.liveLayout&&p.secItem!=null){p.secItem.startTime=_dc.startTime;p.secItem.endTime=_dc.endTime;this._secondarySheet._layoutRenderers(this._secondarySheet.renderData);}else{if(p.ownerItem!=null&&this.owner.liveLayout){p.ownerItem.startTime=_dc.startTime;p.ownerItem.endTime=_dc.endTime;this.owner._layoutRenderers(this.owner.renderData);}}return true;},_findRenderItem:function(id,_e9){_e9=_e9||this.renderData.items;for(var i=0;i<_e9.length;i++){if(_e9[i].id==id){return _e9[i];}}return null;},_onItemEditMoveGesture:function(e){this._dispatchCalendarEvt(e,"onItemEditMoveGesture");if(!e.isDefaultPrevented()){var p=e.source._edProps;var rd=this.renderData;var cal=rd.dateModule;var _ea,_eb;if(p.rendererKind=="label"||(this.roundToDay&&!e.item.allDay)){_ea=this.floorToDay(e.item.startTime,false,rd);_ea.setHours(p._itemEditBeginSave.getHours());_ea.setMinutes(p._itemEditBeginSave.getMinutes());_eb=cal.add(_ea,"millisecond",p._initDuration);}else{if(e.item.allDay){_ea=this.floorToDay(e.item.startTime,true);_eb=cal.add(_ea,"day",p._initDuration);}else{_ea=this.floorDate(e.item.startTime,this.snapUnit,this.snapSteps);_eb=cal.add(_ea,"millisecond",p._initDuration);}}e.item.startTime=_ea;e.item.endTime=_eb;if(!p.inViewOnce){p.inViewOnce=this._isItemInView(e.item);}if(p.inViewOnce&&this.stayInView){this._ensureItemInView(e.item);}}},_DAY_IN_MILLISECONDS:24*60*60*1000,onItemEditMoveGesture:function(e){},_onItemEditResizeGesture:function(e){this._dispatchCalendarEvt(e,"onItemEditResizeGesture");if(!e.isDefaultPrevented()){var p=e.source._edProps;var rd=this.renderData;var cal=rd.dateModule;var _ec=e.item.startTime;var _ed=e.item.endTime;if(e.editKind=="resizeStart"){if(e.item.allDay){_ec=this.floorToDay(e.item.startTime,false,this.renderData);}else{if(this.roundToDay){_ec=this.floorToDay(e.item.startTime,false,rd);_ec.setHours(p._itemEditBeginSave.getHours());_ec.setMinutes(p._itemEditBeginSave.getMinutes());}else{_ec=this.floorDate(e.item.startTime,this.snapUnit,this.snapSteps);}}}else{if(e.editKind=="resizeEnd"){if(e.item.allDay){if(!this.isStartOfDay(e.item.endTime)){_ed=this.floorToDay(e.item.endTime,false,this.renderData);_ed=cal.add(_ed,"day",1);}}else{if(this.roundToDay){_ed=this.floorToDay(e.item.endTime,false,rd);_ed.setHours(p._itemEditEndSave.getHours());_ed.setMinutes(p._itemEditEndSave.getMinutes());}else{_ed=this.floorDate(e.item.endTime,this.snapUnit,this.snapSteps);if(e.eventSource=="mouse"){_ed=cal.add(_ed,this.snapUnit,this.snapSteps);}}}}else{_ec=this.floorDate(e.item.startTime,this.snapUnit,this.snapSteps);_ed=this.floorDate(e.item.endTime,this.snapUnit,this.snapSteps);_ed=cal.add(_ed,this.snapUnit,this.snapSteps);}}e.item.startTime=_ec;e.item.endTime=_ed;var _ee=e.item.allDay||p._initDuration>=this._DAY_IN_MILLISECONDS&&!this.allowResizeLessThan24H;this.ensureMinimalDuration(this.renderData,e.item,_ee?"day":this.minDurationUnit,_ee?1:this.minDurationSteps,e.editKind);if(!p.inViewOnce){p.inViewOnce=this._isItemInView(e.item);}if(p.inViewOnce&&this.stayInView){this._ensureItemInView(e.item);}}},onItemEditResizeGesture:function(e){},_endItemEditingGesture:function(_ef,e){if(!this._isEditing){return;}this._editingGesture=false;var p=this._edProps;var _f0=p.editedItem;p.itemBeginDispatched=false;this._onItemEditEndGesture(_2.mixin(this._createItemEditEvent(),{item:_f0,storeItem:p.storeItem,startTime:_f0.startTime,endTime:_f0.endTime,editKind:p.editKind,rendererKind:p.rendererKind,triggerEvent:e,eventSource:_ef}));},_onItemEditEndGesture:function(e){var p=this._edProps;delete p._itemEditBeginSave;delete p._itemEditEndSave;this._dispatchCalendarEvt(e,"onItemEditEndGesture");if(!e.isDefaultPrevented()){if(p.editLayer){if(_7("ie")){p.editLayer.style.cursor="default";}setTimeout(_2.hitch(this,function(){if(this.domNode){this.domNode.focus();p.editLayer.parentNode.removeChild(p.editLayer);p.editLayer=null;}}),10);}}},onItemEditEndGesture:function(e){},ensureMinimalDuration:function(_f1,_f2,_f3,_f4,_f5){var _f6;var cal=_f1.dateModule;if(_f5=="resizeStart"){_f6=cal.add(_f2.endTime,_f3,-_f4);if(cal.compare(_f2.startTime,_f6)==1){_f2.startTime=_f6;}}else{_f6=cal.add(_f2.startTime,_f3,_f4);if(cal.compare(_f2.endTime,_f6)==-1){_f2.endTime=_f6;}}},doubleTapDelay:300,snapUnit:"minute",snapSteps:15,minDurationUnit:"hour",minDurationSteps:1,liveLayout:false,stayInView:true,allowStartEndSwap:true,allowResizeLessThan24H:false,allowSubColumnMove:true});});