//>>built
define("demos/video/src",["dojo","dijit","dojox","dojo/require!dojox/av/FLVideo,dijit/form/Button,dijit/form/HorizontalSlider,dojo/dnd/Source,dojo/parser,dojox/analytics/Urchin"],function(_1,_2,_3){_1.require("dojox.av.FLVideo");_1.require("dijit.form.Button");_1.require("dijit.form.HorizontalSlider");_1.require("dojo.dnd.Source");_1.require("dojo.parser");_1.require("dojox.analytics.Urchin");var _4,_5,_6,_7,_8;var _9={};var _a={onDropExternal:function(){console.warn("DROP --- check to copy, move, or none:",_9);var _b=_1.byId(_9.dragNode.id);var _c=_9.dropNode;if(_c.id=="videoOverlay"){return;}arguments[2]=true;this.inherited("onDropExternal",arguments);}};_1.extend(_1.dnd.Target,_a);createRelated=function(_d){var _e="<span class=\"relText\">Related Items:</span>";_1.forEach(_d,function(m){var id=m.title.replace(/\s/g,"");var _f="media/"+id+".flv";var _10="media/thumbs/"+id+".jpg";_e+="<div class=\"related\" id=\"click_"+id+"\"><div class=\"thumb\" style=\"background-image:url(media/thumbs/"+id+".jpg)\"></div>"+"<div class=\"title\">"+m.title+"</div>"+"<div class=\"desc\">"+m.desc+"</div></div>";});_e+="";return _e;};_1.addOnLoad(function(){_8=_1.byId("library");_7=dnd_library;_1.xhrGet({url:"items.json",handleAs:"json",load:function(_11){_5.setItems(_11);var txt="";_1.forEach(_11,function(m){var id=m.id=m.title.replace(/\s/g,"");var _12=m.path="media/"+id+".flv";var _13=m.thumb="media/thumbs/"+id+".jpg";txt+=""+"<div class=\"dojoDndItem\" id=\"dnd_"+id+"\" path=\""+_12+"\" dndType=\"blue\">"+"<div id=\""+id+"\" class=\"thumb\" style=\"background-image:url("+_13+");\"></div>"+"<div class=\"title\">"+m.title+"</div>"+"<div class=\"desc\">"+m.desc+"</div>"+"</div>";});_8.innerHTML=txt;_7.sync();_5.load(_11[0].path);}});_4=new _3.av.FLVideo({initialVolume:0.2,isDebug:false},"video");_1.connect(_4,"onLoad",_5,"init");_1.connect(_4,"onClick",_5,"toggle");_1.connect(_4,"onMetaData",_5.progress,"onMeta");_1.connect(_4,"onEnd",_5,"onEnd");_1.connect(_4,"onStart",_5,"onStart");_1.connect(_4,"onPosition",_5.progress,"onPosition");_1.subscribe("/dnd/source/over",function(evt){if(evt){if(evt.node){_9.dropNode=evt.node;}if(evt.anchor){_9.dragNode=evt.anchor;}}});_1.subscribe("/dnd/start",function(evt){});_1.subscribe("/dnd/drop",function(evt){var _14=_1.byId(_9.dragNode.id);var _15=_9.dropNode;if(_15.id=="videoOverlay"){var _16=_1.attr(_14,"path");_5.load(_16);_5.showPause();}});_1.subscribe("/dnd/cancel",function(evt){});new _3.analytics.Urchin({acct:"UA-3572741-1",GAonLoad:function(){this.trackPageView("/demos/video");}});});_5={progress:{init:function(){this.duration=null;this.seeking=false;this.progressBar=_2.byId("progress");_1.connect(this.progressBar.sliderHandle,"mousedown",this,"startDrag");this.timeNode=_1.byId("timeNode");this.durNode=_1.byId("durNode");this.initialized=true;},onMeta:function(_17){if(_17&&_17.duration){this.duration=_17.duration;this.durNode.innerHTML=this.timecode(this.duration);this.progressBar.attr("disabled",false);}else{this.duration=null;this.durNode.innerHTML="NA";this.progressBar.attr("disabled",true);this.progressBar.attr("value",0);}},onDrag:function(val){if(this.seeking){var p=val*0.01;_4.seek(this.duration*p);}},startDrag:function(){this.seeking=true;this.conChg=_1.connect(this.progressBar,"onChange",this,"onDrag");this.conUp=_1.connect(_1.doc,"mouseup",this,"endDrag");},endDrag:function(){this.seeking=false;_1.disconnect(this.conUp);_1.disconnect(this.conChg);},onPosition:function(_18){if(this.initialized){this.timeNode.innerHTML=this.timecode(_18);if(this.duration){if(!this.seeking){var p=Math.min(_18/this.duration,1);this.progressBar.attr("value",p*100);}}}},timecode:function(_19){ts=_19.toString();if(ts.indexOf(".")<0){ts+=".00";}else{if(ts.length-ts.indexOf(".")==2){ts+="0";}else{if(ts.length-ts.indexOf(".")>2){ts=ts.substring(0,ts.indexOf(".")+3);}}}return ts;}},volume:{init:function(){this.volNode=_1.byId("volume");this.volBack=_1.byId("volBack");_1.setSelectable(this.volNode,false);_1.setSelectable(this.volBack,false);_1.setSelectable(_1.byId("volMask"),false);this.volDim=_1.coords(this.volNode);var v=_4.initialVolume;_1.style(this.volBack,"backgroundPosition","-"+(this.volDim.w-(this.volDim.w*v))+"px 0px");_1.connect(this.volNode,"mousedown",this,"begDrag");_1.connect(_1.doc,"mouseup",this,"endDrag");_1.connect(this.volNode,"mouseover",this,"over");_1.connect(this.volNode,"mouseout",this,"out");},onDrag:function(evt){var x=evt.clientX-this.volDim.x;if(x<0){x=0;}if(x>this.volDim.w){x=this.volDim.w;}var p=x/this.volDim.w;_4.volume(p);var _1a=x;x=Math.ceil(x*0.1)*10;_1.style(this.volBack,"backgroundPosition","-"+(this.volDim.w-x)+"px 0px");},begDrag:function(){this.dragging=true;this.conMove=_1.connect(_1.doc,"mousemove",this,"onDrag");},endDrag:function(){if(this.conMove){_1.disconnect(this.conMove);}this.dragging=false;this.out();},over:function(){_1.addClass(this.volBack,"volBackHover");},out:function(){if(!this.dragging){_1.removeClass(this.volBack,"volBackHover");}}},init:function(){this.progress.init();this.volume.init();this.initialized=true;},setItems:function(_1b){this.items=_1b;},onStart:function(){this.hideOverlay();this.showPause();if(this.conM1){_1.disconnect(this.conM1);}if(this.conM2){_1.disconnect(this.conM1);}if(this.conTog){_1.disconnect(this.conTog);}this.conTog=_1.connect(_1.byId("videoOverlay"),"click",this,"toggle");},toggle:function(){if(_4.isPlaying){_4.pause();}else{_4.play();}},onEnd:function(){_1.disconnect(this.conTog);var rel,m1,m2;for(var i=0,len=this.items.length;i<len;i++){if(this.items[i].path==this.currentPath){m1=i+1;m2=i+2;if(m1>len-1){m1=0;m2=1;}else{if(m2>len-1){m2=0;}}break;}}m1=this.items[m1];m2=this.items[m2];var txt=createRelated([m1,m2]);_1.byId("relatedNode").innerHTML=txt;this.conM1=_1.connect(_1.byId("click_"+m1.id),"click",this,function(){this.load(m1.path);});this.conM2=_1.connect(_1.byId("click_"+m2.id),"click",this,function(){this.load(m2.path);});this.showOverlay();this.showPlay();},hideOverlay:function(){_1.style(_1.byId("relatedContainer"),"display","none");_1.style(_1.byId("relatedBack"),"display","none");},showOverlay:function(){_1.style(_1.byId("relatedContainer"),"display","");_1.style(_1.byId("relatedBack"),"display","");_1.fadeIn({node:"relatedContainer",start:0,end:0.9,duration:500}).play();_1.fadeIn({node:"relatedBack",start:0,end:0.5,duration:500}).play();},doSlider:function(val){},load:function(_1c){if(!this.initialized){var c=_1.connect(this,"init",this,function(){this.load(_1c);_1.disconnect(c);});return;}this.currentPath=_1c;_4.play(_1c);this.hideOverlay();this.showPause();},doPlay:function(){_4.play();this.hideOverlay();this.showPause();},doPause:function(){_4.pause();this.showPlay();},showPlay:function(){_1.style(_2.byId("pauseButton").domNode,"display","none");_1.style(_2.byId("playButton").domNode,"display","");},showPause:function(){_1.style(_2.byId("pauseButton").domNode,"display","");_1.style(_2.byId("playButton").domNode,"display","none");}};});